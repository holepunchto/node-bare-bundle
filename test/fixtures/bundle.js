module.exports = Buffer.from('MTk0Mwp7InZlcnNpb24iOjAsIm1haW4iOiIvdGVzdC5qcyIsImltcG9ydHMiOnt9LCJyZXNvbHV0aW9ucyI6eyIvdGVzdC5qcyI6eyJzdHJlYW14IjoiL25vZGVfbW9kdWxlcy9zdHJlYW14L2luZGV4LmpzIn0sIi9ub2RlX21vZHVsZXMvc3RyZWFteC9pbmRleC5qcyI6eyJldmVudHMiOiIvbm9kZV9tb2R1bGVzL2JhcmUtZXZlbnRzL2luZGV4LmpzIiwicXVldWUtdGljayI6Ii9ub2RlX21vZHVsZXMvcXVldWUtdGljay9wcm9jZXNzLW5leHQtdGljay5qcyIsImZhc3QtZmlmbyI6Ii9ub2RlX21vZHVsZXMvZmFzdC1maWZvL2luZGV4LmpzIiwiYmFyZTpwYWNrYWdlIjoiL25vZGVfbW9kdWxlcy9zdHJlYW14L3BhY2thZ2UuanNvbiJ9LCIvbm9kZV9tb2R1bGVzL2JhcmUtZXZlbnRzL2luZGV4LmpzIjp7Ii4vbGliL2Vycm9ycyI6Ii9ub2RlX21vZHVsZXMvYmFyZS1ldmVudHMvbGliL2Vycm9ycy5qcyIsImJhcmU6cGFja2FnZSI6Ii9ub2RlX21vZHVsZXMvYmFyZS1ldmVudHMvcGFja2FnZS5qc29uIn0sIi9ub2RlX21vZHVsZXMvcXVldWUtdGljay9wcm9jZXNzLW5leHQtdGljay5qcyI6eyIuL3F1ZXVlLW1pY3JvdGFzayI6Ii9ub2RlX21vZHVsZXMvcXVldWUtdGljay9xdWV1ZS1taWNyb3Rhc2suanMiLCJiYXJlOnBhY2thZ2UiOiIvbm9kZV9tb2R1bGVzL3F1ZXVlLXRpY2svcGFja2FnZS5qc29uIn0sIi9ub2RlX21vZHVsZXMvZmFzdC1maWZvL2luZGV4LmpzIjp7Ii4vZml4ZWQtc2l6ZSI6Ii9ub2RlX21vZHVsZXMvZmFzdC1maWZvL2ZpeGVkLXNpemUuanMiLCJiYXJlOnBhY2thZ2UiOiIvbm9kZV9tb2R1bGVzL2Zhc3QtZmlmby9wYWNrYWdlLmpzb24ifSwiL25vZGVfbW9kdWxlcy9iYXJlLWV2ZW50cy9saWIvZXJyb3JzLmpzIjp7ImJhcmU6cGFja2FnZSI6Ii9ub2RlX21vZHVsZXMvYmFyZS1ldmVudHMvcGFja2FnZS5qc29uIn0sIi9ub2RlX21vZHVsZXMvcXVldWUtdGljay9xdWV1ZS1taWNyb3Rhc2suanMiOnsiYmFyZTpwYWNrYWdlIjoiL25vZGVfbW9kdWxlcy9xdWV1ZS10aWNrL3BhY2thZ2UuanNvbiJ9LCIvbm9kZV9tb2R1bGVzL2Zhc3QtZmlmby9maXhlZC1zaXplLmpzIjp7ImJhcmU6cGFja2FnZSI6Ii9ub2RlX21vZHVsZXMvZmFzdC1maWZvL3BhY2thZ2UuanNvbiJ9fSwiZmlsZXMiOnsiL3Rlc3QuanMiOnsib2Zmc2V0IjowLCJsZW5ndGgiOjEwN30sIi9ub2RlX21vZHVsZXMvc3RyZWFteC9pbmRleC5qcyI6eyJvZmZzZXQiOjEwNywibGVuZ3RoIjozMDQzNX0sIi9ub2RlX21vZHVsZXMvYmFyZS1ldmVudHMvaW5kZXguanMiOnsib2Zmc2V0IjozMDU0MiwibGVuZ3RoIjo1NTMwfSwiL25vZGVfbW9kdWxlcy9xdWV1ZS10aWNrL3Byb2Nlc3MtbmV4dC10aWNrLmpzIjp7Im9mZnNldCI6MzYwNzIsImxlbmd0aCI6MTYwfSwiL25vZGVfbW9kdWxlcy9mYXN0LWZpZm8vaW5kZXguanMiOnsib2Zmc2V0IjozNjIzMiwibGVuZ3RoIjo5NzJ9LCIvbm9kZV9tb2R1bGVzL3N0cmVhbXgvcGFja2FnZS5qc29uIjp7Im9mZnNldCI6MzcyMDQsImxlbmd0aCI6ODI4fSwiL25vZGVfbW9kdWxlcy9iYXJlLWV2ZW50cy9saWIvZXJyb3JzLmpzIjp7Im9mZnNldCI6MzgwMzIsImxlbmd0aCI6NDg3fSwiL25vZGVfbW9kdWxlcy9iYXJlLWV2ZW50cy9wYWNrYWdlLmpzb24iOnsib2Zmc2V0IjozODUxOSwibGVuZ3RoIjo2MDl9LCIvbm9kZV9tb2R1bGVzL3F1ZXVlLXRpY2svcXVldWUtbWljcm90YXNrLmpzIjp7Im9mZnNldCI6MzkxMjgsImxlbmd0aCI6MTA4fSwiL25vZGVfbW9kdWxlcy9xdWV1ZS10aWNrL3BhY2thZ2UuanNvbiI6eyJvZmZzZXQiOjM5MjM2LCJsZW5ndGgiOjY2OX0sIi9ub2RlX21vZHVsZXMvZmFzdC1maWZvL2ZpeGVkLXNpemUuanMiOnsib2Zmc2V0IjozOTkwNSwibGVuZ3RoIjo4NzV9LCIvbm9kZV9tb2R1bGVzL2Zhc3QtZmlmby9wYWNrYWdlLmpzb24iOnsib2Zmc2V0Ijo0MDc4MCwibGVuZ3RoIjo2ODJ9fX0KY29uc3QgeyBSZWFkYWJsZSB9ID0gcmVxdWlyZSgnc3RyZWFteCcpCgpjb25zdCBycyA9IG5ldyBSZWFkYWJsZSgpCgpycy5wdXNoKCd3b3JrcyEnKQoKbW9kdWxlLmV4cG9ydHMgPSBycwpjb25zdCB7IEV2ZW50RW1pdHRlciB9ID0gcmVxdWlyZSgnZXZlbnRzJykKY29uc3QgU1RSRUFNX0RFU1RST1lFRCA9IG5ldyBFcnJvcignU3RyZWFtIHdhcyBkZXN0cm95ZWQnKQpjb25zdCBQUkVNQVRVUkVfQ0xPU0UgPSBuZXcgRXJyb3IoJ1ByZW1hdHVyZSBjbG9zZScpCgpjb25zdCBxdWV1ZVRpY2sgPSByZXF1aXJlKCdxdWV1ZS10aWNrJykKY29uc3QgRklGTyA9IHJlcXVpcmUoJ2Zhc3QtZmlmbycpCgovKiBlc2xpbnQtZGlzYWJsZSBuby1tdWx0aS1zcGFjZXMgKi8KCi8vIDI3IGJpdHMgdXNlZCB0b3RhbCAoNCBmcm9tIHNoYXJlZCwgMTMgZnJvbSByZWFkLCBhbmQgMTAgZnJvbSB3cml0ZSkKY29uc3QgTUFYID0gKCgxIDw8IDI3KSAtIDEpCgovLyBTaGFyZWQgc3RhdGUKY29uc3QgT1BFTklORyAgICAgICA9IDBiMDAwMQpjb25zdCBQUkVERVNUUk9ZSU5HID0gMGIwMDEwCmNvbnN0IERFU1RST1lJTkcgICAgPSAwYjAxMDAKY29uc3QgREVTVFJPWUVEICAgICA9IDBiMTAwMAoKY29uc3QgTk9UX09QRU5JTkcgPSBNQVggXiBPUEVOSU5HCmNvbnN0IE5PVF9QUkVERVNUUk9ZSU5HID0gTUFYIF4gUFJFREVTVFJPWUlORwoKLy8gUmVhZCBzdGF0ZSAoNCBiaXQgb2Zmc2V0IGZyb20gc2hhcmVkIHN0YXRlKQpjb25zdCBSRUFEX0FDVElWRSAgICAgICAgICAgPSAwYjAwMDAwMDAwMDAwMDEgPDwgNApjb25zdCBSRUFEX1VQREFUSU5HICAgICAgICAgPSAwYjAwMDAwMDAwMDAwMTAgPDwgNApjb25zdCBSRUFEX1BSSU1BUlkgICAgICAgICAgPSAwYjAwMDAwMDAwMDAxMDAgPDwgNApjb25zdCBSRUFEX1FVRVVFRCAgICAgICAgICAgPSAwYjAwMDAwMDAwMDEwMDAgPDwgNApjb25zdCBSRUFEX1JFU1VNRUQgICAgICAgICAgPSAwYjAwMDAwMDAwMTAwMDAgPDwgNApjb25zdCBSRUFEX1BJUEVfRFJBSU5FRCAgICAgPSAwYjAwMDAwMDAxMDAwMDAgPDwgNApjb25zdCBSRUFEX0VORElORyAgICAgICAgICAgPSAwYjAwMDAwMDEwMDAwMDAgPDwgNApjb25zdCBSRUFEX0VNSVRfREFUQSAgICAgICAgPSAwYjAwMDAwMTAwMDAwMDAgPDwgNApjb25zdCBSRUFEX0VNSVRfUkVBREFCTEUgICAgPSAwYjAwMDAxMDAwMDAwMDAgPDwgNApjb25zdCBSRUFEX0VNSVRURURfUkVBREFCTEUgPSAwYjAwMDEwMDAwMDAwMDAgPDwgNApjb25zdCBSRUFEX0RPTkUgICAgICAgICAgICAgPSAwYjAwMTAwMDAwMDAwMDAgPDwgNApjb25zdCBSRUFEX05FWFRfVElDSyAgICAgICAgPSAwYjAxMDAwMDAwMDAwMDAgPDwgNApjb25zdCBSRUFEX05FRURTX1BVU0ggICAgICAgPSAwYjEwMDAwMDAwMDAwMDAgPDwgNAoKLy8gQ29tYmluZWQgcmVhZCBzdGF0ZQpjb25zdCBSRUFEX0ZMT1dJTkcgPSBSRUFEX1JFU1VNRUQgfCBSRUFEX1BJUEVfRFJBSU5FRApjb25zdCBSRUFEX0FDVElWRV9BTkRfTkVFRFNfUFVTSCA9IFJFQURfQUNUSVZFIHwgUkVBRF9ORUVEU19QVVNICmNvbnN0IFJFQURfUFJJTUFSWV9BTkRfQUNUSVZFID0gUkVBRF9QUklNQVJZIHwgUkVBRF9BQ1RJVkUKY29uc3QgUkVBRF9FTUlUX1JFQURBQkxFX0FORF9RVUVVRUQgPSBSRUFEX0VNSVRfUkVBREFCTEUgfCBSRUFEX1FVRVVFRAoKY29uc3QgUkVBRF9OT1RfQUNUSVZFICAgICAgICAgICAgID0gTUFYIF4gUkVBRF9BQ1RJVkUKY29uc3QgUkVBRF9OT05fUFJJTUFSWSAgICAgICAgICAgID0gTUFYIF4gUkVBRF9QUklNQVJZCmNvbnN0IFJFQURfTk9OX1BSSU1BUllfQU5EX1BVU0hFRCA9IE1BWCBeIChSRUFEX1BSSU1BUlkgfCBSRUFEX05FRURTX1BVU0gpCmNvbnN0IFJFQURfUFVTSEVEICAgICAgICAgICAgICAgICA9IE1BWCBeIFJFQURfTkVFRFNfUFVTSApjb25zdCBSRUFEX1BBVVNFRCAgICAgICAgICAgICAgICAgPSBNQVggXiBSRUFEX1JFU1VNRUQKY29uc3QgUkVBRF9OT1RfUVVFVUVEICAgICAgICAgICAgID0gTUFYIF4gKFJFQURfUVVFVUVEIHwgUkVBRF9FTUlUVEVEX1JFQURBQkxFKQpjb25zdCBSRUFEX05PVF9FTkRJTkcgICAgICAgICAgICAgPSBNQVggXiBSRUFEX0VORElORwpjb25zdCBSRUFEX1BJUEVfTk9UX0RSQUlORUQgICAgICAgPSBNQVggXiBSRUFEX0ZMT1dJTkcKY29uc3QgUkVBRF9OT1RfTkVYVF9USUNLICAgICAgICAgID0gTUFYIF4gUkVBRF9ORVhUX1RJQ0sKY29uc3QgUkVBRF9OT1RfVVBEQVRJTkcgICAgICAgICAgID0gTUFYIF4gUkVBRF9VUERBVElORwoKLy8gV3JpdGUgc3RhdGUgKDE3IGJpdCBvZmZzZXQsIDQgYml0IG9mZnNldCBmcm9tIHNoYXJlZCBzdGF0ZSBhbmQgMTMgZnJvbSByZWFkIHN0YXRlKQpjb25zdCBXUklURV9BQ1RJVkUgICAgID0gMGIwMDAwMDAwMDAxIDw8IDE3CmNvbnN0IFdSSVRFX1VQREFUSU5HICAgPSAwYjAwMDAwMDAwMTAgPDwgMTcKY29uc3QgV1JJVEVfUFJJTUFSWSAgICA9IDBiMDAwMDAwMDEwMCA8PCAxNwpjb25zdCBXUklURV9RVUVVRUQgICAgID0gMGIwMDAwMDAxMDAwIDw8IDE3CmNvbnN0IFdSSVRFX1VORFJBSU5FRCAgPSAwYjAwMDAwMTAwMDAgPDwgMTcKY29uc3QgV1JJVEVfRE9ORSAgICAgICA9IDBiMDAwMDEwMDAwMCA8PCAxNwpjb25zdCBXUklURV9FTUlUX0RSQUlOID0gMGIwMDAxMDAwMDAwIDw8IDE3CmNvbnN0IFdSSVRFX05FWFRfVElDSyAgPSAwYjAwMTAwMDAwMDAgPDwgMTcKY29uc3QgV1JJVEVfV1JJVElORyAgICA9IDBiMDEwMDAwMDAwMCA8PCAxNwpjb25zdCBXUklURV9GSU5JU0hJTkcgID0gMGIxMDAwMDAwMDAwIDw8IDE3Cgpjb25zdCBXUklURV9OT1RfQUNUSVZFICAgID0gTUFYIF4gKFdSSVRFX0FDVElWRSB8IFdSSVRFX1dSSVRJTkcpCmNvbnN0IFdSSVRFX05PTl9QUklNQVJZICAgPSBNQVggXiBXUklURV9QUklNQVJZCmNvbnN0IFdSSVRFX05PVF9GSU5JU0hJTkcgPSBNQVggXiBXUklURV9GSU5JU0hJTkcKY29uc3QgV1JJVEVfRFJBSU5FRCAgICAgICA9IE1BWCBeIFdSSVRFX1VORFJBSU5FRApjb25zdCBXUklURV9OT1RfUVVFVUVEICAgID0gTUFYIF4gV1JJVEVfUVVFVUVECmNvbnN0IFdSSVRFX05PVF9ORVhUX1RJQ0sgPSBNQVggXiBXUklURV9ORVhUX1RJQ0sKY29uc3QgV1JJVEVfTk9UX1VQREFUSU5HICA9IE1BWCBeIFdSSVRFX1VQREFUSU5HCgovLyBDb21iaW5lZCBzaGFyZWQgc3RhdGUKY29uc3QgQUNUSVZFID0gUkVBRF9BQ1RJVkUgfCBXUklURV9BQ1RJVkUKY29uc3QgTk9UX0FDVElWRSA9IE1BWCBeIEFDVElWRQpjb25zdCBET05FID0gUkVBRF9ET05FIHwgV1JJVEVfRE9ORQpjb25zdCBERVNUUk9ZX1NUQVRVUyA9IERFU1RST1lJTkcgfCBERVNUUk9ZRUQgfCBQUkVERVNUUk9ZSU5HCmNvbnN0IE9QRU5fU1RBVFVTID0gREVTVFJPWV9TVEFUVVMgfCBPUEVOSU5HCmNvbnN0IEFVVE9fREVTVFJPWSA9IERFU1RST1lfU1RBVFVTIHwgRE9ORQpjb25zdCBOT05fUFJJTUFSWSA9IFdSSVRFX05PTl9QUklNQVJZICYgUkVBRF9OT05fUFJJTUFSWQpjb25zdCBBQ1RJVkVfT1JfVElDS0lORyA9IFdSSVRFX05FWFRfVElDSyB8IFJFQURfTkVYVF9USUNLCmNvbnN0IFRJQ0tJTkcgPSBBQ1RJVkVfT1JfVElDS0lORyAmIE5PVF9BQ1RJVkUKY29uc3QgSVNfT1BFTklORyA9IE9QRU5fU1RBVFVTIHwgVElDS0lORwoKLy8gQ29tYmluZWQgc2hhcmVkIHN0YXRlIGFuZCByZWFkIHN0YXRlCmNvbnN0IFJFQURfUFJJTUFSWV9TVEFUVVMgPSBPUEVOX1NUQVRVUyB8IFJFQURfRU5ESU5HIHwgUkVBRF9ET05FCmNvbnN0IFJFQURfU1RBVFVTID0gT1BFTl9TVEFUVVMgfCBSRUFEX0RPTkUgfCBSRUFEX1FVRVVFRApjb25zdCBSRUFEX0VORElOR19TVEFUVVMgPSBPUEVOX1NUQVRVUyB8IFJFQURfRU5ESU5HIHwgUkVBRF9RVUVVRUQKY29uc3QgUkVBRF9SRUFEQUJMRV9TVEFUVVMgPSBPUEVOX1NUQVRVUyB8IFJFQURfRU1JVF9SRUFEQUJMRSB8IFJFQURfUVVFVUVEIHwgUkVBRF9FTUlUVEVEX1JFQURBQkxFCmNvbnN0IFNIT1VMRF9OT1RfUkVBRCA9IE9QRU5fU1RBVFVTIHwgUkVBRF9BQ1RJVkUgfCBSRUFEX0VORElORyB8IFJFQURfRE9ORSB8IFJFQURfTkVFRFNfUFVTSApjb25zdCBSRUFEX0JBQ0tQUkVTU1VSRV9TVEFUVVMgPSBERVNUUk9ZX1NUQVRVUyB8IFJFQURfRU5ESU5HIHwgUkVBRF9ET05FCmNvbnN0IFJFQURfVVBEQVRFX1NZTkNfU1RBVFVTID0gUkVBRF9VUERBVElORyB8IE9QRU5fU1RBVFVTIHwgUkVBRF9ORVhUX1RJQ0sgfCBSRUFEX1BSSU1BUlkKCi8vIENvbWJpbmVkIHdyaXRlIHN0YXRlCmNvbnN0IFdSSVRFX1BSSU1BUllfU1RBVFVTID0gT1BFTl9TVEFUVVMgfCBXUklURV9GSU5JU0hJTkcgfCBXUklURV9ET05FCmNvbnN0IFdSSVRFX1FVRVVFRF9BTkRfVU5EUkFJTkVEID0gV1JJVEVfUVVFVUVEIHwgV1JJVEVfVU5EUkFJTkVECmNvbnN0IFdSSVRFX1FVRVVFRF9BTkRfQUNUSVZFID0gV1JJVEVfUVVFVUVEIHwgV1JJVEVfQUNUSVZFCmNvbnN0IFdSSVRFX0RSQUlOX1NUQVRVUyA9IFdSSVRFX1FVRVVFRCB8IFdSSVRFX1VORFJBSU5FRCB8IE9QRU5fU1RBVFVTIHwgV1JJVEVfQUNUSVZFCmNvbnN0IFdSSVRFX1NUQVRVUyA9IE9QRU5fU1RBVFVTIHwgV1JJVEVfQUNUSVZFIHwgV1JJVEVfUVVFVUVECmNvbnN0IFdSSVRFX1BSSU1BUllfQU5EX0FDVElWRSA9IFdSSVRFX1BSSU1BUlkgfCBXUklURV9BQ1RJVkUKY29uc3QgV1JJVEVfQUNUSVZFX0FORF9XUklUSU5HID0gV1JJVEVfQUNUSVZFIHwgV1JJVEVfV1JJVElORwpjb25zdCBXUklURV9GSU5JU0hJTkdfU1RBVFVTID0gT1BFTl9TVEFUVVMgfCBXUklURV9GSU5JU0hJTkcgfCBXUklURV9RVUVVRURfQU5EX0FDVElWRSB8IFdSSVRFX0RPTkUKY29uc3QgV1JJVEVfQkFDS1BSRVNTVVJFX1NUQVRVUyA9IFdSSVRFX1VORFJBSU5FRCB8IERFU1RST1lfU1RBVFVTIHwgV1JJVEVfRklOSVNISU5HIHwgV1JJVEVfRE9ORQpjb25zdCBXUklURV9VUERBVEVfU1lOQ19TVEFUVVMgPSBXUklURV9VUERBVElORyB8IE9QRU5fU1RBVFVTIHwgV1JJVEVfTkVYVF9USUNLIHwgV1JJVEVfUFJJTUFSWQoKY29uc3QgYXN5bmNJdGVyYXRvciA9IFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8IFN5bWJvbCgnYXN5bmNJdGVyYXRvcicpCgpjbGFzcyBXcml0YWJsZVN0YXRlIHsKICBjb25zdHJ1Y3RvciAoc3RyZWFtLCB7IGhpZ2hXYXRlck1hcmsgPSAxNjM4NCwgbWFwID0gbnVsbCwgbWFwV3JpdGFibGUsIGJ5dGVMZW5ndGgsIGJ5dGVMZW5ndGhXcml0YWJsZSB9ID0ge30pIHsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtCiAgICB0aGlzLnF1ZXVlID0gbmV3IEZJRk8oKQogICAgdGhpcy5oaWdoV2F0ZXJNYXJrID0gaGlnaFdhdGVyTWFyawogICAgdGhpcy5idWZmZXJlZCA9IDAKICAgIHRoaXMuZXJyb3IgPSBudWxsCiAgICB0aGlzLnBpcGVsaW5lID0gbnVsbAogICAgdGhpcy5kcmFpbnMgPSBudWxsIC8vIGlmIHdlIGFkZCBtb3JlIHNlbGRvbWx5IHVzZWQgaGVscGVycyB3ZSBtaWdodCB0aGVtIGludG8gYSBzdWJvYmplY3Qgc28gaXRzIGEgc2luZ2xlIHB0cgogICAgdGhpcy5ieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aFdyaXRhYmxlIHx8IGJ5dGVMZW5ndGggfHwgZGVmYXVsdEJ5dGVMZW5ndGgKICAgIHRoaXMubWFwID0gbWFwV3JpdGFibGUgfHwgbWFwCiAgICB0aGlzLmFmdGVyV3JpdGUgPSBhZnRlcldyaXRlLmJpbmQodGhpcykKICAgIHRoaXMuYWZ0ZXJVcGRhdGVOZXh0VGljayA9IHVwZGF0ZVdyaXRlTlQuYmluZCh0aGlzKQogIH0KCiAgZ2V0IGVuZGVkICgpIHsKICAgIHJldHVybiAodGhpcy5zdHJlYW0uX2R1cGxleFN0YXRlICYgV1JJVEVfRE9ORSkgIT09IDAKICB9CgogIHB1c2ggKGRhdGEpIHsKICAgIGlmICh0aGlzLm1hcCAhPT0gbnVsbCkgZGF0YSA9IHRoaXMubWFwKGRhdGEpCgogICAgdGhpcy5idWZmZXJlZCArPSB0aGlzLmJ5dGVMZW5ndGgoZGF0YSkKICAgIHRoaXMucXVldWUucHVzaChkYXRhKQoKICAgIGlmICh0aGlzLmJ1ZmZlcmVkIDwgdGhpcy5oaWdoV2F0ZXJNYXJrKSB7CiAgICAgIHRoaXMuc3RyZWFtLl9kdXBsZXhTdGF0ZSB8PSBXUklURV9RVUVVRUQKICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICB0aGlzLnN0cmVhbS5fZHVwbGV4U3RhdGUgfD0gV1JJVEVfUVVFVUVEX0FORF9VTkRSQUlORUQKICAgIHJldHVybiBmYWxzZQogIH0KCiAgc2hpZnQgKCkgewogICAgY29uc3QgZGF0YSA9IHRoaXMucXVldWUuc2hpZnQoKQoKICAgIHRoaXMuYnVmZmVyZWQgLT0gdGhpcy5ieXRlTGVuZ3RoKGRhdGEpCiAgICBpZiAodGhpcy5idWZmZXJlZCA9PT0gMCkgdGhpcy5zdHJlYW0uX2R1cGxleFN0YXRlICY9IFdSSVRFX05PVF9RVUVVRUQKCiAgICByZXR1cm4gZGF0YQogIH0KCiAgZW5kIChkYXRhKSB7CiAgICBpZiAodHlwZW9mIGRhdGEgPT09ICdmdW5jdGlvbicpIHRoaXMuc3RyZWFtLm9uY2UoJ2ZpbmlzaCcsIGRhdGEpCiAgICBlbHNlIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YSAhPT0gbnVsbCkgdGhpcy5wdXNoKGRhdGEpCiAgICB0aGlzLnN0cmVhbS5fZHVwbGV4U3RhdGUgPSAodGhpcy5zdHJlYW0uX2R1cGxleFN0YXRlIHwgV1JJVEVfRklOSVNISU5HKSAmIFdSSVRFX05PTl9QUklNQVJZCiAgfQoKICBhdXRvQmF0Y2ggKGRhdGEsIGNiKSB7CiAgICBjb25zdCBidWZmZXIgPSBbXQogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW0KCiAgICBidWZmZXIucHVzaChkYXRhKQogICAgd2hpbGUgKChzdHJlYW0uX2R1cGxleFN0YXRlICYgV1JJVEVfU1RBVFVTKSA9PT0gV1JJVEVfUVVFVUVEX0FORF9BQ1RJVkUpIHsKICAgICAgYnVmZmVyLnB1c2goc3RyZWFtLl93cml0YWJsZVN0YXRlLnNoaWZ0KCkpCiAgICB9CgogICAgaWYgKChzdHJlYW0uX2R1cGxleFN0YXRlICYgT1BFTl9TVEFUVVMpICE9PSAwKSByZXR1cm4gY2IobnVsbCkKICAgIHN0cmVhbS5fd3JpdGV2KGJ1ZmZlciwgY2IpCiAgfQoKICB1cGRhdGUgKCkgewogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW0KCiAgICBzdHJlYW0uX2R1cGxleFN0YXRlIHw9IFdSSVRFX1VQREFUSU5HCgogICAgZG8gewogICAgICB3aGlsZSAoKHN0cmVhbS5fZHVwbGV4U3RhdGUgJiBXUklURV9TVEFUVVMpID09PSBXUklURV9RVUVVRUQpIHsKICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5zaGlmdCgpCiAgICAgICAgc3RyZWFtLl9kdXBsZXhTdGF0ZSB8PSBXUklURV9BQ1RJVkVfQU5EX1dSSVRJTkcKICAgICAgICBzdHJlYW0uX3dyaXRlKGRhdGEsIHRoaXMuYWZ0ZXJXcml0ZSkKICAgICAgfQoKICAgICAgaWYgKChzdHJlYW0uX2R1cGxleFN0YXRlICYgV1JJVEVfUFJJTUFSWV9BTkRfQUNUSVZFKSA9PT0gMCkgdGhpcy51cGRhdGVOb25QcmltYXJ5KCkKICAgIH0gd2hpbGUgKHRoaXMuY29udGludWVVcGRhdGUoKSA9PT0gdHJ1ZSkKCiAgICBzdHJlYW0uX2R1cGxleFN0YXRlICY9IFdSSVRFX05PVF9VUERBVElORwogIH0KCiAgdXBkYXRlTm9uUHJpbWFyeSAoKSB7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzLnN0cmVhbQoKICAgIGlmICgoc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIFdSSVRFX0ZJTklTSElOR19TVEFUVVMpID09PSBXUklURV9GSU5JU0hJTkcpIHsKICAgICAgc3RyZWFtLl9kdXBsZXhTdGF0ZSA9IChzdHJlYW0uX2R1cGxleFN0YXRlIHwgV1JJVEVfQUNUSVZFKSAmIFdSSVRFX05PVF9GSU5JU0hJTkcKICAgICAgc3RyZWFtLl9maW5hbChhZnRlckZpbmFsLmJpbmQodGhpcykpCiAgICAgIHJldHVybgogICAgfQoKICAgIGlmICgoc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIERFU1RST1lfU1RBVFVTKSA9PT0gREVTVFJPWUlORykgewogICAgICBpZiAoKHN0cmVhbS5fZHVwbGV4U3RhdGUgJiBBQ1RJVkVfT1JfVElDS0lORykgPT09IDApIHsKICAgICAgICBzdHJlYW0uX2R1cGxleFN0YXRlIHw9IEFDVElWRQogICAgICAgIHN0cmVhbS5fZGVzdHJveShhZnRlckRlc3Ryb3kuYmluZCh0aGlzKSkKICAgICAgfQogICAgICByZXR1cm4KICAgIH0KCiAgICBpZiAoKHN0cmVhbS5fZHVwbGV4U3RhdGUgJiBJU19PUEVOSU5HKSA9PT0gT1BFTklORykgewogICAgICBzdHJlYW0uX2R1cGxleFN0YXRlID0gKHN0cmVhbS5fZHVwbGV4U3RhdGUgfCBBQ1RJVkUpICYgTk9UX09QRU5JTkcKICAgICAgc3RyZWFtLl9vcGVuKGFmdGVyT3Blbi5iaW5kKHRoaXMpKQogICAgfQogIH0KCiAgY29udGludWVVcGRhdGUgKCkgewogICAgaWYgKCh0aGlzLnN0cmVhbS5fZHVwbGV4U3RhdGUgJiBXUklURV9ORVhUX1RJQ0spID09PSAwKSByZXR1cm4gZmFsc2UKICAgIHRoaXMuc3RyZWFtLl9kdXBsZXhTdGF0ZSAmPSBXUklURV9OT1RfTkVYVF9USUNLCiAgICByZXR1cm4gdHJ1ZQogIH0KCiAgdXBkYXRlQ2FsbGJhY2sgKCkgewogICAgaWYgKCh0aGlzLnN0cmVhbS5fZHVwbGV4U3RhdGUgJiBXUklURV9VUERBVEVfU1lOQ19TVEFUVVMpID09PSBXUklURV9QUklNQVJZKSB0aGlzLnVwZGF0ZSgpCiAgICBlbHNlIHRoaXMudXBkYXRlTmV4dFRpY2soKQogIH0KCiAgdXBkYXRlTmV4dFRpY2sgKCkgewogICAgaWYgKCh0aGlzLnN0cmVhbS5fZHVwbGV4U3RhdGUgJiBXUklURV9ORVhUX1RJQ0spICE9PSAwKSByZXR1cm4KICAgIHRoaXMuc3RyZWFtLl9kdXBsZXhTdGF0ZSB8PSBXUklURV9ORVhUX1RJQ0sKICAgIGlmICgodGhpcy5zdHJlYW0uX2R1cGxleFN0YXRlICYgV1JJVEVfVVBEQVRJTkcpID09PSAwKSBxdWV1ZVRpY2sodGhpcy5hZnRlclVwZGF0ZU5leHRUaWNrKQogIH0KfQoKY2xhc3MgUmVhZGFibGVTdGF0ZSB7CiAgY29uc3RydWN0b3IgKHN0cmVhbSwgeyBoaWdoV2F0ZXJNYXJrID0gMTYzODQsIG1hcCA9IG51bGwsIG1hcFJlYWRhYmxlLCBieXRlTGVuZ3RoLCBieXRlTGVuZ3RoUmVhZGFibGUgfSA9IHt9KSB7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbQogICAgdGhpcy5xdWV1ZSA9IG5ldyBGSUZPKCkKICAgIHRoaXMuaGlnaFdhdGVyTWFyayA9IGhpZ2hXYXRlck1hcmsKICAgIHRoaXMuYnVmZmVyZWQgPSAwCiAgICB0aGlzLmVycm9yID0gbnVsbAogICAgdGhpcy5waXBlbGluZSA9IG51bGwKICAgIHRoaXMuYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGhSZWFkYWJsZSB8fCBieXRlTGVuZ3RoIHx8IGRlZmF1bHRCeXRlTGVuZ3RoCiAgICB0aGlzLm1hcCA9IG1hcFJlYWRhYmxlIHx8IG1hcAogICAgdGhpcy5waXBlVG8gPSBudWxsCiAgICB0aGlzLmFmdGVyUmVhZCA9IGFmdGVyUmVhZC5iaW5kKHRoaXMpCiAgICB0aGlzLmFmdGVyVXBkYXRlTmV4dFRpY2sgPSB1cGRhdGVSZWFkTlQuYmluZCh0aGlzKQogIH0KCiAgZ2V0IGVuZGVkICgpIHsKICAgIHJldHVybiAodGhpcy5zdHJlYW0uX2R1cGxleFN0YXRlICYgUkVBRF9ET05FKSAhPT0gMAogIH0KCiAgcGlwZSAocGlwZVRvLCBjYikgewogICAgaWYgKHRoaXMucGlwZVRvICE9PSBudWxsKSB0aHJvdyBuZXcgRXJyb3IoJ0NhbiBvbmx5IHBpcGUgdG8gb25lIGRlc3RpbmF0aW9uJykKICAgIGlmICh0eXBlb2YgY2IgIT09ICdmdW5jdGlvbicpIGNiID0gbnVsbAoKICAgIHRoaXMuc3RyZWFtLl9kdXBsZXhTdGF0ZSB8PSBSRUFEX1BJUEVfRFJBSU5FRAogICAgdGhpcy5waXBlVG8gPSBwaXBlVG8KICAgIHRoaXMucGlwZWxpbmUgPSBuZXcgUGlwZWxpbmUodGhpcy5zdHJlYW0sIHBpcGVUbywgY2IpCgogICAgaWYgKGNiKSB0aGlzLnN0cmVhbS5vbignZXJyb3InLCBub29wKSAvLyBXZSBhbHJlYWR5IGVycm9yIGhhbmRsZSB0aGlzIHNvIHN1cHJlc3MgY3Jhc2hlcwoKICAgIGlmIChpc1N0cmVhbXgocGlwZVRvKSkgewogICAgICBwaXBlVG8uX3dyaXRhYmxlU3RhdGUucGlwZWxpbmUgPSB0aGlzLnBpcGVsaW5lCiAgICAgIGlmIChjYikgcGlwZVRvLm9uKCdlcnJvcicsIG5vb3ApIC8vIFdlIGFscmVhZHkgZXJyb3IgaGFuZGxlIHRoaXMgc28gc3VwcmVzcyBjcmFzaGVzCiAgICAgIHBpcGVUby5vbignZmluaXNoJywgdGhpcy5waXBlbGluZS5maW5pc2hlZC5iaW5kKHRoaXMucGlwZWxpbmUpKSAvLyBUT0RPOiBqdXN0IGNhbGwgZmluaXNoZWQgZnJvbSBwaXBlVG8gaXRzZWxmCiAgICB9IGVsc2UgewogICAgICBjb25zdCBvbmVycm9yID0gdGhpcy5waXBlbGluZS5kb25lLmJpbmQodGhpcy5waXBlbGluZSwgcGlwZVRvKQogICAgICBjb25zdCBvbmNsb3NlID0gdGhpcy5waXBlbGluZS5kb25lLmJpbmQodGhpcy5waXBlbGluZSwgcGlwZVRvLCBudWxsKSAvLyBvbmNsb3NlIGhhcyBhIHdlaXJkIGJvb2wgYXJnCiAgICAgIHBpcGVUby5vbignZXJyb3InLCBvbmVycm9yKQogICAgICBwaXBlVG8ub24oJ2Nsb3NlJywgb25jbG9zZSkKICAgICAgcGlwZVRvLm9uKCdmaW5pc2gnLCB0aGlzLnBpcGVsaW5lLmZpbmlzaGVkLmJpbmQodGhpcy5waXBlbGluZSkpCiAgICB9CgogICAgcGlwZVRvLm9uKCdkcmFpbicsIGFmdGVyRHJhaW4uYmluZCh0aGlzKSkKICAgIHRoaXMuc3RyZWFtLmVtaXQoJ3BpcGluZycsIHBpcGVUbykKICAgIHBpcGVUby5lbWl0KCdwaXBlJywgdGhpcy5zdHJlYW0pCiAgfQoKICBwdXNoIChkYXRhKSB7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzLnN0cmVhbQoKICAgIGlmIChkYXRhID09PSBudWxsKSB7CiAgICAgIHRoaXMuaGlnaFdhdGVyTWFyayA9IDAKICAgICAgc3RyZWFtLl9kdXBsZXhTdGF0ZSA9IChzdHJlYW0uX2R1cGxleFN0YXRlIHwgUkVBRF9FTkRJTkcpICYgUkVBRF9OT05fUFJJTUFSWV9BTkRfUFVTSEVECiAgICAgIHJldHVybiBmYWxzZQogICAgfQoKICAgIGlmICh0aGlzLm1hcCAhPT0gbnVsbCkgZGF0YSA9IHRoaXMubWFwKGRhdGEpCiAgICB0aGlzLmJ1ZmZlcmVkICs9IHRoaXMuYnl0ZUxlbmd0aChkYXRhKQogICAgdGhpcy5xdWV1ZS5wdXNoKGRhdGEpCgogICAgc3RyZWFtLl9kdXBsZXhTdGF0ZSA9IChzdHJlYW0uX2R1cGxleFN0YXRlIHwgUkVBRF9RVUVVRUQpICYgUkVBRF9QVVNIRUQKCiAgICByZXR1cm4gdGhpcy5idWZmZXJlZCA8IHRoaXMuaGlnaFdhdGVyTWFyawogIH0KCiAgc2hpZnQgKCkgewogICAgY29uc3QgZGF0YSA9IHRoaXMucXVldWUuc2hpZnQoKQoKICAgIHRoaXMuYnVmZmVyZWQgLT0gdGhpcy5ieXRlTGVuZ3RoKGRhdGEpCiAgICBpZiAodGhpcy5idWZmZXJlZCA9PT0gMCkgdGhpcy5zdHJlYW0uX2R1cGxleFN0YXRlICY9IFJFQURfTk9UX1FVRVVFRAogICAgcmV0dXJuIGRhdGEKICB9CgogIHVuc2hpZnQgKGRhdGEpIHsKICAgIGNvbnN0IHBlbmRpbmcgPSBbdGhpcy5tYXAgIT09IG51bGwgPyB0aGlzLm1hcChkYXRhKSA6IGRhdGFdCiAgICB3aGlsZSAodGhpcy5idWZmZXJlZCA+IDApIHBlbmRpbmcucHVzaCh0aGlzLnNoaWZ0KCkpCgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwZW5kaW5nLmxlbmd0aCAtIDE7IGkrKykgewogICAgICBjb25zdCBkYXRhID0gcGVuZGluZ1tpXQogICAgICB0aGlzLmJ1ZmZlcmVkICs9IHRoaXMuYnl0ZUxlbmd0aChkYXRhKQogICAgICB0aGlzLnF1ZXVlLnB1c2goZGF0YSkKICAgIH0KCiAgICB0aGlzLnB1c2gocGVuZGluZ1twZW5kaW5nLmxlbmd0aCAtIDFdKQogIH0KCiAgcmVhZCAoKSB7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzLnN0cmVhbQoKICAgIGlmICgoc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIFJFQURfU1RBVFVTKSA9PT0gUkVBRF9RVUVVRUQpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuc2hpZnQoKQogICAgICBpZiAodGhpcy5waXBlVG8gIT09IG51bGwgJiYgdGhpcy5waXBlVG8ud3JpdGUoZGF0YSkgPT09IGZhbHNlKSBzdHJlYW0uX2R1cGxleFN0YXRlICY9IFJFQURfUElQRV9OT1RfRFJBSU5FRAogICAgICBpZiAoKHN0cmVhbS5fZHVwbGV4U3RhdGUgJiBSRUFEX0VNSVRfREFUQSkgIT09IDApIHN0cmVhbS5lbWl0KCdkYXRhJywgZGF0YSkKICAgICAgcmV0dXJuIGRhdGEKICAgIH0KCiAgICByZXR1cm4gbnVsbAogIH0KCiAgZHJhaW4gKCkgewogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW0KCiAgICB3aGlsZSAoKHN0cmVhbS5fZHVwbGV4U3RhdGUgJiBSRUFEX1NUQVRVUykgPT09IFJFQURfUVVFVUVEICYmIChzdHJlYW0uX2R1cGxleFN0YXRlICYgUkVBRF9GTE9XSU5HKSAhPT0gMCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5zaGlmdCgpCiAgICAgIGlmICh0aGlzLnBpcGVUbyAhPT0gbnVsbCAmJiB0aGlzLnBpcGVUby53cml0ZShkYXRhKSA9PT0gZmFsc2UpIHN0cmVhbS5fZHVwbGV4U3RhdGUgJj0gUkVBRF9QSVBFX05PVF9EUkFJTkVECiAgICAgIGlmICgoc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIFJFQURfRU1JVF9EQVRBKSAhPT0gMCkgc3RyZWFtLmVtaXQoJ2RhdGEnLCBkYXRhKQogICAgfQogIH0KCiAgdXBkYXRlICgpIHsKICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuc3RyZWFtCgogICAgc3RyZWFtLl9kdXBsZXhTdGF0ZSB8PSBSRUFEX1VQREFUSU5HCgogICAgZG8gewogICAgICB0aGlzLmRyYWluKCkKCiAgICAgIHdoaWxlICh0aGlzLmJ1ZmZlcmVkIDwgdGhpcy5oaWdoV2F0ZXJNYXJrICYmIChzdHJlYW0uX2R1cGxleFN0YXRlICYgU0hPVUxEX05PVF9SRUFEKSA9PT0gMCkgewogICAgICAgIHN0cmVhbS5fZHVwbGV4U3RhdGUgfD0gUkVBRF9BQ1RJVkVfQU5EX05FRURTX1BVU0gKICAgICAgICBzdHJlYW0uX3JlYWQodGhpcy5hZnRlclJlYWQpCiAgICAgICAgdGhpcy5kcmFpbigpCiAgICAgIH0KCiAgICAgIGlmICgoc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIFJFQURfUkVBREFCTEVfU1RBVFVTKSA9PT0gUkVBRF9FTUlUX1JFQURBQkxFX0FORF9RVUVVRUQpIHsKICAgICAgICBzdHJlYW0uX2R1cGxleFN0YXRlIHw9IFJFQURfRU1JVFRFRF9SRUFEQUJMRQogICAgICAgIHN0cmVhbS5lbWl0KCdyZWFkYWJsZScpCiAgICAgIH0KCiAgICAgIGlmICgoc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIFJFQURfUFJJTUFSWV9BTkRfQUNUSVZFKSA9PT0gMCkgdGhpcy51cGRhdGVOb25QcmltYXJ5KCkKICAgIH0gd2hpbGUgKHRoaXMuY29udGludWVVcGRhdGUoKSA9PT0gdHJ1ZSkKCiAgICBzdHJlYW0uX2R1cGxleFN0YXRlICY9IFJFQURfTk9UX1VQREFUSU5HCiAgfQoKICB1cGRhdGVOb25QcmltYXJ5ICgpIHsKICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuc3RyZWFtCgogICAgaWYgKChzdHJlYW0uX2R1cGxleFN0YXRlICYgUkVBRF9FTkRJTkdfU1RBVFVTKSA9PT0gUkVBRF9FTkRJTkcpIHsKICAgICAgc3RyZWFtLl9kdXBsZXhTdGF0ZSA9IChzdHJlYW0uX2R1cGxleFN0YXRlIHwgUkVBRF9ET05FKSAmIFJFQURfTk9UX0VORElORwogICAgICBzdHJlYW0uZW1pdCgnZW5kJykKICAgICAgaWYgKChzdHJlYW0uX2R1cGxleFN0YXRlICYgQVVUT19ERVNUUk9ZKSA9PT0gRE9ORSkgc3RyZWFtLl9kdXBsZXhTdGF0ZSB8PSBERVNUUk9ZSU5HCiAgICAgIGlmICh0aGlzLnBpcGVUbyAhPT0gbnVsbCkgdGhpcy5waXBlVG8uZW5kKCkKICAgIH0KCiAgICBpZiAoKHN0cmVhbS5fZHVwbGV4U3RhdGUgJiBERVNUUk9ZX1NUQVRVUykgPT09IERFU1RST1lJTkcpIHsKICAgICAgaWYgKChzdHJlYW0uX2R1cGxleFN0YXRlICYgQUNUSVZFX09SX1RJQ0tJTkcpID09PSAwKSB7CiAgICAgICAgc3RyZWFtLl9kdXBsZXhTdGF0ZSB8PSBBQ1RJVkUKICAgICAgICBzdHJlYW0uX2Rlc3Ryb3koYWZ0ZXJEZXN0cm95LmJpbmQodGhpcykpCiAgICAgIH0KICAgICAgcmV0dXJuCiAgICB9CgogICAgaWYgKChzdHJlYW0uX2R1cGxleFN0YXRlICYgSVNfT1BFTklORykgPT09IE9QRU5JTkcpIHsKICAgICAgc3RyZWFtLl9kdXBsZXhTdGF0ZSA9IChzdHJlYW0uX2R1cGxleFN0YXRlIHwgQUNUSVZFKSAmIE5PVF9PUEVOSU5HCiAgICAgIHN0cmVhbS5fb3BlbihhZnRlck9wZW4uYmluZCh0aGlzKSkKICAgIH0KICB9CgogIGNvbnRpbnVlVXBkYXRlICgpIHsKICAgIGlmICgodGhpcy5zdHJlYW0uX2R1cGxleFN0YXRlICYgUkVBRF9ORVhUX1RJQ0spID09PSAwKSByZXR1cm4gZmFsc2UKICAgIHRoaXMuc3RyZWFtLl9kdXBsZXhTdGF0ZSAmPSBSRUFEX05PVF9ORVhUX1RJQ0sKICAgIHJldHVybiB0cnVlCiAgfQoKICB1cGRhdGVDYWxsYmFjayAoKSB7CiAgICBpZiAoKHRoaXMuc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIFJFQURfVVBEQVRFX1NZTkNfU1RBVFVTKSA9PT0gUkVBRF9QUklNQVJZKSB0aGlzLnVwZGF0ZSgpCiAgICBlbHNlIHRoaXMudXBkYXRlTmV4dFRpY2soKQogIH0KCiAgdXBkYXRlTmV4dFRpY2sgKCkgewogICAgaWYgKCh0aGlzLnN0cmVhbS5fZHVwbGV4U3RhdGUgJiBSRUFEX05FWFRfVElDSykgIT09IDApIHJldHVybgogICAgdGhpcy5zdHJlYW0uX2R1cGxleFN0YXRlIHw9IFJFQURfTkVYVF9USUNLCiAgICBpZiAoKHRoaXMuc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIFJFQURfVVBEQVRJTkcpID09PSAwKSBxdWV1ZVRpY2sodGhpcy5hZnRlclVwZGF0ZU5leHRUaWNrKQogIH0KfQoKY2xhc3MgVHJhbnNmb3JtU3RhdGUgewogIGNvbnN0cnVjdG9yIChzdHJlYW0pIHsKICAgIHRoaXMuZGF0YSA9IG51bGwKICAgIHRoaXMuYWZ0ZXJUcmFuc2Zvcm0gPSBhZnRlclRyYW5zZm9ybS5iaW5kKHN0cmVhbSkKICAgIHRoaXMuYWZ0ZXJGaW5hbCA9IG51bGwKICB9Cn0KCmNsYXNzIFBpcGVsaW5lIHsKICBjb25zdHJ1Y3RvciAoc3JjLCBkc3QsIGNiKSB7CiAgICB0aGlzLmZyb20gPSBzcmMKICAgIHRoaXMudG8gPSBkc3QKICAgIHRoaXMuYWZ0ZXJQaXBlID0gY2IKICAgIHRoaXMuZXJyb3IgPSBudWxsCiAgICB0aGlzLnBpcGVUb0ZpbmlzaGVkID0gZmFsc2UKICB9CgogIGZpbmlzaGVkICgpIHsKICAgIHRoaXMucGlwZVRvRmluaXNoZWQgPSB0cnVlCiAgfQoKICBkb25lIChzdHJlYW0sIGVycikgewogICAgaWYgKGVycikgdGhpcy5lcnJvciA9IGVycgoKICAgIGlmIChzdHJlYW0gPT09IHRoaXMudG8pIHsKICAgICAgdGhpcy50byA9IG51bGwKCiAgICAgIGlmICh0aGlzLmZyb20gIT09IG51bGwpIHsKICAgICAgICBpZiAoKHRoaXMuZnJvbS5fZHVwbGV4U3RhdGUgJiBSRUFEX0RPTkUpID09PSAwIHx8ICF0aGlzLnBpcGVUb0ZpbmlzaGVkKSB7CiAgICAgICAgICB0aGlzLmZyb20uZGVzdHJveSh0aGlzLmVycm9yIHx8IG5ldyBFcnJvcignV3JpdGFibGUgc3RyZWFtIGNsb3NlZCBwcmVtYXR1cmVseScpKQogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgICAgfQogICAgfQoKICAgIGlmIChzdHJlYW0gPT09IHRoaXMuZnJvbSkgewogICAgICB0aGlzLmZyb20gPSBudWxsCgogICAgICBpZiAodGhpcy50byAhPT0gbnVsbCkgewogICAgICAgIGlmICgoc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIFJFQURfRE9ORSkgPT09IDApIHsKICAgICAgICAgIHRoaXMudG8uZGVzdHJveSh0aGlzLmVycm9yIHx8IG5ldyBFcnJvcignUmVhZGFibGUgc3RyZWFtIGNsb3NlZCBiZWZvcmUgZW5kaW5nJykpCiAgICAgICAgfQogICAgICAgIHJldHVybgogICAgICB9CiAgICB9CgogICAgaWYgKHRoaXMuYWZ0ZXJQaXBlICE9PSBudWxsKSB0aGlzLmFmdGVyUGlwZSh0aGlzLmVycm9yKQogICAgdGhpcy50byA9IHRoaXMuZnJvbSA9IHRoaXMuYWZ0ZXJQaXBlID0gbnVsbAogIH0KfQoKZnVuY3Rpb24gYWZ0ZXJEcmFpbiAoKSB7CiAgdGhpcy5zdHJlYW0uX2R1cGxleFN0YXRlIHw9IFJFQURfUElQRV9EUkFJTkVECiAgdGhpcy51cGRhdGVDYWxsYmFjaygpCn0KCmZ1bmN0aW9uIGFmdGVyRmluYWwgKGVycikgewogIGNvbnN0IHN0cmVhbSA9IHRoaXMuc3RyZWFtCiAgaWYgKGVycikgc3RyZWFtLmRlc3Ryb3koZXJyKQogIGlmICgoc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIERFU1RST1lfU1RBVFVTKSA9PT0gMCkgewogICAgc3RyZWFtLl9kdXBsZXhTdGF0ZSB8PSBXUklURV9ET05FCiAgICBzdHJlYW0uZW1pdCgnZmluaXNoJykKICB9CiAgaWYgKChzdHJlYW0uX2R1cGxleFN0YXRlICYgQVVUT19ERVNUUk9ZKSA9PT0gRE9ORSkgewogICAgc3RyZWFtLl9kdXBsZXhTdGF0ZSB8PSBERVNUUk9ZSU5HCiAgfQoKICBzdHJlYW0uX2R1cGxleFN0YXRlICY9IFdSSVRFX05PVF9BQ1RJVkUKCiAgLy8gbm8gbmVlZCB0byB3YWl0IHRoZSBleHRyYSB0aWNrIGhlcmUsIHNvIHdlIHNob3J0IGNpcmN1aXQgdGhhdAogIGlmICgoc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIFdSSVRFX1VQREFUSU5HKSA9PT0gMCkgdGhpcy51cGRhdGUoKQogIGVsc2UgdGhpcy51cGRhdGVOZXh0VGljaygpCn0KCmZ1bmN0aW9uIGFmdGVyRGVzdHJveSAoZXJyKSB7CiAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW0KCiAgaWYgKCFlcnIgJiYgdGhpcy5lcnJvciAhPT0gU1RSRUFNX0RFU1RST1lFRCkgZXJyID0gdGhpcy5lcnJvcgogIGlmIChlcnIpIHN0cmVhbS5lbWl0KCdlcnJvcicsIGVycikKICBzdHJlYW0uX2R1cGxleFN0YXRlIHw9IERFU1RST1lFRAogIHN0cmVhbS5lbWl0KCdjbG9zZScpCgogIGNvbnN0IHJzID0gc3RyZWFtLl9yZWFkYWJsZVN0YXRlCiAgY29uc3Qgd3MgPSBzdHJlYW0uX3dyaXRhYmxlU3RhdGUKCiAgaWYgKHJzICE9PSBudWxsICYmIHJzLnBpcGVsaW5lICE9PSBudWxsKSBycy5waXBlbGluZS5kb25lKHN0cmVhbSwgZXJyKQoKICBpZiAod3MgIT09IG51bGwpIHsKICAgIHdoaWxlICh3cy5kcmFpbnMgIT09IG51bGwgJiYgd3MuZHJhaW5zLmxlbmd0aCA+IDApIHdzLmRyYWlucy5zaGlmdCgpLnJlc29sdmUoZmFsc2UpCiAgICBpZiAod3MucGlwZWxpbmUgIT09IG51bGwpIHdzLnBpcGVsaW5lLmRvbmUoc3RyZWFtLCBlcnIpCiAgfQp9CgpmdW5jdGlvbiBhZnRlcldyaXRlIChlcnIpIHsKICBjb25zdCBzdHJlYW0gPSB0aGlzLnN0cmVhbQoKICBpZiAoZXJyKSBzdHJlYW0uZGVzdHJveShlcnIpCiAgc3RyZWFtLl9kdXBsZXhTdGF0ZSAmPSBXUklURV9OT1RfQUNUSVZFCgogIGlmICh0aGlzLmRyYWlucyAhPT0gbnVsbCkgdGlja0RyYWlucyh0aGlzLmRyYWlucykKCiAgaWYgKChzdHJlYW0uX2R1cGxleFN0YXRlICYgV1JJVEVfRFJBSU5fU1RBVFVTKSA9PT0gV1JJVEVfVU5EUkFJTkVEKSB7CiAgICBzdHJlYW0uX2R1cGxleFN0YXRlICY9IFdSSVRFX0RSQUlORUQKICAgIGlmICgoc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIFdSSVRFX0VNSVRfRFJBSU4pID09PSBXUklURV9FTUlUX0RSQUlOKSB7CiAgICAgIHN0cmVhbS5lbWl0KCdkcmFpbicpCiAgICB9CiAgfQoKICB0aGlzLnVwZGF0ZUNhbGxiYWNrKCkKfQoKZnVuY3Rpb24gYWZ0ZXJSZWFkIChlcnIpIHsKICBpZiAoZXJyKSB0aGlzLnN0cmVhbS5kZXN0cm95KGVycikKICB0aGlzLnN0cmVhbS5fZHVwbGV4U3RhdGUgJj0gUkVBRF9OT1RfQUNUSVZFCiAgdGhpcy51cGRhdGVDYWxsYmFjaygpCn0KCmZ1bmN0aW9uIHVwZGF0ZVJlYWROVCAoKSB7CiAgaWYgKCh0aGlzLnN0cmVhbS5fZHVwbGV4U3RhdGUgJiBSRUFEX1VQREFUSU5HKSA9PT0gMCkgewogICAgdGhpcy5zdHJlYW0uX2R1cGxleFN0YXRlICY9IFJFQURfTk9UX05FWFRfVElDSwogICAgdGhpcy51cGRhdGUoKQogIH0KfQoKZnVuY3Rpb24gdXBkYXRlV3JpdGVOVCAoKSB7CiAgaWYgKCh0aGlzLnN0cmVhbS5fZHVwbGV4U3RhdGUgJiBXUklURV9VUERBVElORykgPT09IDApIHsKICAgIHRoaXMuc3RyZWFtLl9kdXBsZXhTdGF0ZSAmPSBXUklURV9OT1RfTkVYVF9USUNLCiAgICB0aGlzLnVwZGF0ZSgpCiAgfQp9CgpmdW5jdGlvbiB0aWNrRHJhaW5zIChkcmFpbnMpIHsKICBmb3IgKGxldCBpID0gMDsgaSA8IGRyYWlucy5sZW5ndGg7IGkrKykgewogICAgLy8gZHJhaW5zLndyaXRlcyBhcmUgbW9ub3RvbmljLCBzbyBpZiBvbmUgaXMgMCBpdHMgYWx3YXlzIHRoZSBmaXJzdCBvbmUKICAgIGlmICgtLWRyYWluc1tpXS53cml0ZXMgPT09IDApIHsKICAgICAgZHJhaW5zLnNoaWZ0KCkucmVzb2x2ZSh0cnVlKQogICAgICBpLS0KICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGFmdGVyT3BlbiAoZXJyKSB7CiAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW0KCiAgaWYgKGVycikgc3RyZWFtLmRlc3Ryb3koZXJyKQoKICBpZiAoKHN0cmVhbS5fZHVwbGV4U3RhdGUgJiBERVNUUk9ZSU5HKSA9PT0gMCkgewogICAgaWYgKChzdHJlYW0uX2R1cGxleFN0YXRlICYgUkVBRF9QUklNQVJZX1NUQVRVUykgPT09IDApIHN0cmVhbS5fZHVwbGV4U3RhdGUgfD0gUkVBRF9QUklNQVJZCiAgICBpZiAoKHN0cmVhbS5fZHVwbGV4U3RhdGUgJiBXUklURV9QUklNQVJZX1NUQVRVUykgPT09IDApIHN0cmVhbS5fZHVwbGV4U3RhdGUgfD0gV1JJVEVfUFJJTUFSWQogICAgc3RyZWFtLmVtaXQoJ29wZW4nKQogIH0KCiAgc3RyZWFtLl9kdXBsZXhTdGF0ZSAmPSBOT1RfQUNUSVZFCgogIGlmIChzdHJlYW0uX3dyaXRhYmxlU3RhdGUgIT09IG51bGwpIHsKICAgIHN0cmVhbS5fd3JpdGFibGVTdGF0ZS51cGRhdGVDYWxsYmFjaygpCiAgfQoKICBpZiAoc3RyZWFtLl9yZWFkYWJsZVN0YXRlICE9PSBudWxsKSB7CiAgICBzdHJlYW0uX3JlYWRhYmxlU3RhdGUudXBkYXRlQ2FsbGJhY2soKQogIH0KfQoKZnVuY3Rpb24gYWZ0ZXJUcmFuc2Zvcm0gKGVyciwgZGF0YSkgewogIGlmIChkYXRhICE9PSB1bmRlZmluZWQgJiYgZGF0YSAhPT0gbnVsbCkgdGhpcy5wdXNoKGRhdGEpCiAgdGhpcy5fd3JpdGFibGVTdGF0ZS5hZnRlcldyaXRlKGVycikKfQoKZnVuY3Rpb24gbmV3TGlzdGVuZXIgKG5hbWUpIHsKICBpZiAodGhpcy5fcmVhZGFibGVTdGF0ZSAhPT0gbnVsbCkgewogICAgaWYgKG5hbWUgPT09ICdkYXRhJykgewogICAgICB0aGlzLl9kdXBsZXhTdGF0ZSB8PSAoUkVBRF9FTUlUX0RBVEEgfCBSRUFEX1JFU1VNRUQpCiAgICAgIHRoaXMuX3JlYWRhYmxlU3RhdGUudXBkYXRlTmV4dFRpY2soKQogICAgfQogICAgaWYgKG5hbWUgPT09ICdyZWFkYWJsZScpIHsKICAgICAgdGhpcy5fZHVwbGV4U3RhdGUgfD0gUkVBRF9FTUlUX1JFQURBQkxFCiAgICAgIHRoaXMuX3JlYWRhYmxlU3RhdGUudXBkYXRlTmV4dFRpY2soKQogICAgfQogIH0KCiAgaWYgKHRoaXMuX3dyaXRhYmxlU3RhdGUgIT09IG51bGwpIHsKICAgIGlmIChuYW1lID09PSAnZHJhaW4nKSB7CiAgICAgIHRoaXMuX2R1cGxleFN0YXRlIHw9IFdSSVRFX0VNSVRfRFJBSU4KICAgICAgdGhpcy5fd3JpdGFibGVTdGF0ZS51cGRhdGVOZXh0VGljaygpCiAgICB9CiAgfQp9CgpjbGFzcyBTdHJlYW0gZXh0ZW5kcyBFdmVudEVtaXR0ZXIgewogIGNvbnN0cnVjdG9yIChvcHRzKSB7CiAgICBzdXBlcigpCgogICAgdGhpcy5fZHVwbGV4U3RhdGUgPSAwCiAgICB0aGlzLl9yZWFkYWJsZVN0YXRlID0gbnVsbAogICAgdGhpcy5fd3JpdGFibGVTdGF0ZSA9IG51bGwKCiAgICBpZiAob3B0cykgewogICAgICBpZiAob3B0cy5vcGVuKSB0aGlzLl9vcGVuID0gb3B0cy5vcGVuCiAgICAgIGlmIChvcHRzLmRlc3Ryb3kpIHRoaXMuX2Rlc3Ryb3kgPSBvcHRzLmRlc3Ryb3kKICAgICAgaWYgKG9wdHMucHJlZGVzdHJveSkgdGhpcy5fcHJlZGVzdHJveSA9IG9wdHMucHJlZGVzdHJveQogICAgICBpZiAob3B0cy5zaWduYWwpIHsKICAgICAgICBvcHRzLnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIGFib3J0LmJpbmQodGhpcykpCiAgICAgIH0KICAgIH0KCiAgICB0aGlzLm9uKCduZXdMaXN0ZW5lcicsIG5ld0xpc3RlbmVyKQogIH0KCiAgX29wZW4gKGNiKSB7CiAgICBjYihudWxsKQogIH0KCiAgX2Rlc3Ryb3kgKGNiKSB7CiAgICBjYihudWxsKQogIH0KCiAgX3ByZWRlc3Ryb3kgKCkgewogICAgLy8gZG9lcyBub3RoaW5nCiAgfQoKICBnZXQgcmVhZGFibGUgKCkgewogICAgcmV0dXJuIHRoaXMuX3JlYWRhYmxlU3RhdGUgIT09IG51bGwgPyB0cnVlIDogdW5kZWZpbmVkCiAgfQoKICBnZXQgd3JpdGFibGUgKCkgewogICAgcmV0dXJuIHRoaXMuX3dyaXRhYmxlU3RhdGUgIT09IG51bGwgPyB0cnVlIDogdW5kZWZpbmVkCiAgfQoKICBnZXQgZGVzdHJveWVkICgpIHsKICAgIHJldHVybiAodGhpcy5fZHVwbGV4U3RhdGUgJiBERVNUUk9ZRUQpICE9PSAwCiAgfQoKICBnZXQgZGVzdHJveWluZyAoKSB7CiAgICByZXR1cm4gKHRoaXMuX2R1cGxleFN0YXRlICYgREVTVFJPWV9TVEFUVVMpICE9PSAwCiAgfQoKICBkZXN0cm95IChlcnIpIHsKICAgIGlmICgodGhpcy5fZHVwbGV4U3RhdGUgJiBERVNUUk9ZX1NUQVRVUykgPT09IDApIHsKICAgICAgaWYgKCFlcnIpIGVyciA9IFNUUkVBTV9ERVNUUk9ZRUQKICAgICAgdGhpcy5fZHVwbGV4U3RhdGUgPSAodGhpcy5fZHVwbGV4U3RhdGUgfCBERVNUUk9ZSU5HKSAmIE5PTl9QUklNQVJZCgogICAgICBpZiAodGhpcy5fcmVhZGFibGVTdGF0ZSAhPT0gbnVsbCkgewogICAgICAgIHRoaXMuX3JlYWRhYmxlU3RhdGUuaGlnaFdhdGVyTWFyayA9IDAKICAgICAgICB0aGlzLl9yZWFkYWJsZVN0YXRlLmVycm9yID0gZXJyCiAgICAgIH0KICAgICAgaWYgKHRoaXMuX3dyaXRhYmxlU3RhdGUgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl93cml0YWJsZVN0YXRlLmhpZ2hXYXRlck1hcmsgPSAwCiAgICAgICAgdGhpcy5fd3JpdGFibGVTdGF0ZS5lcnJvciA9IGVycgogICAgICB9CgogICAgICB0aGlzLl9kdXBsZXhTdGF0ZSB8PSBQUkVERVNUUk9ZSU5HCiAgICAgIHRoaXMuX3ByZWRlc3Ryb3koKQogICAgICB0aGlzLl9kdXBsZXhTdGF0ZSAmPSBOT1RfUFJFREVTVFJPWUlORwoKICAgICAgaWYgKHRoaXMuX3JlYWRhYmxlU3RhdGUgIT09IG51bGwpIHRoaXMuX3JlYWRhYmxlU3RhdGUudXBkYXRlTmV4dFRpY2soKQogICAgICBpZiAodGhpcy5fd3JpdGFibGVTdGF0ZSAhPT0gbnVsbCkgdGhpcy5fd3JpdGFibGVTdGF0ZS51cGRhdGVOZXh0VGljaygpCiAgICB9CiAgfQp9CgpjbGFzcyBSZWFkYWJsZSBleHRlbmRzIFN0cmVhbSB7CiAgY29uc3RydWN0b3IgKG9wdHMpIHsKICAgIHN1cGVyKG9wdHMpCgogICAgdGhpcy5fZHVwbGV4U3RhdGUgfD0gT1BFTklORyB8IFdSSVRFX0RPTkUKICAgIHRoaXMuX3JlYWRhYmxlU3RhdGUgPSBuZXcgUmVhZGFibGVTdGF0ZSh0aGlzLCBvcHRzKQoKICAgIGlmIChvcHRzKSB7CiAgICAgIGlmIChvcHRzLnJlYWQpIHRoaXMuX3JlYWQgPSBvcHRzLnJlYWQKICAgICAgaWYgKG9wdHMuZWFnZXJPcGVuKSB0aGlzLl9yZWFkYWJsZVN0YXRlLnVwZGF0ZU5leHRUaWNrKCkKICAgIH0KICB9CgogIF9yZWFkIChjYikgewogICAgY2IobnVsbCkKICB9CgogIHBpcGUgKGRlc3QsIGNiKSB7CiAgICB0aGlzLl9yZWFkYWJsZVN0YXRlLnVwZGF0ZU5leHRUaWNrKCkKICAgIHRoaXMuX3JlYWRhYmxlU3RhdGUucGlwZShkZXN0LCBjYikKICAgIHJldHVybiBkZXN0CiAgfQoKICByZWFkICgpIHsKICAgIHRoaXMuX3JlYWRhYmxlU3RhdGUudXBkYXRlTmV4dFRpY2soKQogICAgcmV0dXJuIHRoaXMuX3JlYWRhYmxlU3RhdGUucmVhZCgpCiAgfQoKICBwdXNoIChkYXRhKSB7CiAgICB0aGlzLl9yZWFkYWJsZVN0YXRlLnVwZGF0ZU5leHRUaWNrKCkKICAgIHJldHVybiB0aGlzLl9yZWFkYWJsZVN0YXRlLnB1c2goZGF0YSkKICB9CgogIHVuc2hpZnQgKGRhdGEpIHsKICAgIHRoaXMuX3JlYWRhYmxlU3RhdGUudXBkYXRlTmV4dFRpY2soKQogICAgcmV0dXJuIHRoaXMuX3JlYWRhYmxlU3RhdGUudW5zaGlmdChkYXRhKQogIH0KCiAgcmVzdW1lICgpIHsKICAgIHRoaXMuX2R1cGxleFN0YXRlIHw9IFJFQURfUkVTVU1FRAogICAgdGhpcy5fcmVhZGFibGVTdGF0ZS51cGRhdGVOZXh0VGljaygpCiAgICByZXR1cm4gdGhpcwogIH0KCiAgcGF1c2UgKCkgewogICAgdGhpcy5fZHVwbGV4U3RhdGUgJj0gUkVBRF9QQVVTRUQKICAgIHJldHVybiB0aGlzCiAgfQoKICBzdGF0aWMgX2Zyb21Bc3luY0l0ZXJhdG9yIChpdGUsIG9wdHMpIHsKICAgIGxldCBkZXN0cm95CgogICAgY29uc3QgcnMgPSBuZXcgUmVhZGFibGUoewogICAgICAuLi5vcHRzLAogICAgICByZWFkIChjYikgewogICAgICAgIGl0ZS5uZXh0KCkudGhlbihwdXNoKS50aGVuKGNiLmJpbmQobnVsbCwgbnVsbCkpLmNhdGNoKGNiKQogICAgICB9LAogICAgICBwcmVkZXN0cm95ICgpIHsKICAgICAgICBkZXN0cm95ID0gaXRlLnJldHVybigpCiAgICAgIH0sCiAgICAgIGRlc3Ryb3kgKGNiKSB7CiAgICAgICAgaWYgKCFkZXN0cm95KSByZXR1cm4gY2IobnVsbCkKICAgICAgICBkZXN0cm95LnRoZW4oY2IuYmluZChudWxsLCBudWxsKSkuY2F0Y2goY2IpCiAgICAgIH0KICAgIH0pCgogICAgcmV0dXJuIHJzCgogICAgZnVuY3Rpb24gcHVzaCAoZGF0YSkgewogICAgICBpZiAoZGF0YS5kb25lKSBycy5wdXNoKG51bGwpCiAgICAgIGVsc2UgcnMucHVzaChkYXRhLnZhbHVlKQogICAgfQogIH0KCiAgc3RhdGljIGZyb20gKGRhdGEsIG9wdHMpIHsKICAgIGlmIChpc1JlYWRTdHJlYW14KGRhdGEpKSByZXR1cm4gZGF0YQogICAgaWYgKGRhdGFbYXN5bmNJdGVyYXRvcl0pIHJldHVybiB0aGlzLl9mcm9tQXN5bmNJdGVyYXRvcihkYXRhW2FzeW5jSXRlcmF0b3JdKCksIG9wdHMpCiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGF0YSkpIGRhdGEgPSBkYXRhID09PSB1bmRlZmluZWQgPyBbXSA6IFtkYXRhXQoKICAgIGxldCBpID0gMAogICAgcmV0dXJuIG5ldyBSZWFkYWJsZSh7CiAgICAgIC4uLm9wdHMsCiAgICAgIHJlYWQgKGNiKSB7CiAgICAgICAgdGhpcy5wdXNoKGkgPT09IGRhdGEubGVuZ3RoID8gbnVsbCA6IGRhdGFbaSsrXSkKICAgICAgICBjYihudWxsKQogICAgICB9CiAgICB9KQogIH0KCiAgc3RhdGljIGlzQmFja3ByZXNzdXJlZCAocnMpIHsKICAgIHJldHVybiAocnMuX2R1cGxleFN0YXRlICYgUkVBRF9CQUNLUFJFU1NVUkVfU1RBVFVTKSAhPT0gMCB8fCBycy5fcmVhZGFibGVTdGF0ZS5idWZmZXJlZCA+PSBycy5fcmVhZGFibGVTdGF0ZS5oaWdoV2F0ZXJNYXJrCiAgfQoKICBzdGF0aWMgaXNQYXVzZWQgKHJzKSB7CiAgICByZXR1cm4gKHJzLl9kdXBsZXhTdGF0ZSAmIFJFQURfUkVTVU1FRCkgPT09IDAKICB9CgogIFthc3luY0l0ZXJhdG9yXSAoKSB7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzCgogICAgbGV0IGVycm9yID0gbnVsbAogICAgbGV0IHByb21pc2VSZXNvbHZlID0gbnVsbAogICAgbGV0IHByb21pc2VSZWplY3QgPSBudWxsCgogICAgdGhpcy5vbignZXJyb3InLCAoZXJyKSA9PiB7IGVycm9yID0gZXJyIH0pCiAgICB0aGlzLm9uKCdyZWFkYWJsZScsIG9ucmVhZGFibGUpCiAgICB0aGlzLm9uKCdjbG9zZScsIG9uY2xvc2UpCgogICAgcmV0dXJuIHsKICAgICAgW2FzeW5jSXRlcmF0b3JdICgpIHsKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9LAogICAgICBuZXh0ICgpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgcHJvbWlzZVJlc29sdmUgPSByZXNvbHZlCiAgICAgICAgICBwcm9taXNlUmVqZWN0ID0gcmVqZWN0CiAgICAgICAgICBjb25zdCBkYXRhID0gc3RyZWFtLnJlYWQoKQogICAgICAgICAgaWYgKGRhdGEgIT09IG51bGwpIG9uZGF0YShkYXRhKQogICAgICAgICAgZWxzZSBpZiAoKHN0cmVhbS5fZHVwbGV4U3RhdGUgJiBERVNUUk9ZRUQpICE9PSAwKSBvbmRhdGEobnVsbCkKICAgICAgICB9KQogICAgICB9LAogICAgICByZXR1cm4gKCkgewogICAgICAgIHJldHVybiBkZXN0cm95KG51bGwpCiAgICAgIH0sCiAgICAgIHRocm93IChlcnIpIHsKICAgICAgICByZXR1cm4gZGVzdHJveShlcnIpCiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBvbnJlYWRhYmxlICgpIHsKICAgICAgaWYgKHByb21pc2VSZXNvbHZlICE9PSBudWxsKSBvbmRhdGEoc3RyZWFtLnJlYWQoKSkKICAgIH0KCiAgICBmdW5jdGlvbiBvbmNsb3NlICgpIHsKICAgICAgaWYgKHByb21pc2VSZXNvbHZlICE9PSBudWxsKSBvbmRhdGEobnVsbCkKICAgIH0KCiAgICBmdW5jdGlvbiBvbmRhdGEgKGRhdGEpIHsKICAgICAgaWYgKHByb21pc2VSZWplY3QgPT09IG51bGwpIHJldHVybgogICAgICBpZiAoZXJyb3IpIHByb21pc2VSZWplY3QoZXJyb3IpCiAgICAgIGVsc2UgaWYgKGRhdGEgPT09IG51bGwgJiYgKHN0cmVhbS5fZHVwbGV4U3RhdGUgJiBSRUFEX0RPTkUpID09PSAwKSBwcm9taXNlUmVqZWN0KFNUUkVBTV9ERVNUUk9ZRUQpCiAgICAgIGVsc2UgcHJvbWlzZVJlc29sdmUoeyB2YWx1ZTogZGF0YSwgZG9uZTogZGF0YSA9PT0gbnVsbCB9KQogICAgICBwcm9taXNlUmVqZWN0ID0gcHJvbWlzZVJlc29sdmUgPSBudWxsCiAgICB9CgogICAgZnVuY3Rpb24gZGVzdHJveSAoZXJyKSB7CiAgICAgIHN0cmVhbS5kZXN0cm95KGVycikKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICBpZiAoc3RyZWFtLl9kdXBsZXhTdGF0ZSAmIERFU1RST1lFRCkgcmV0dXJuIHJlc29sdmUoeyB2YWx1ZTogdW5kZWZpbmVkLCBkb25lOiB0cnVlIH0pCiAgICAgICAgc3RyZWFtLm9uY2UoJ2Nsb3NlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKGVycikgcmVqZWN0KGVycikKICAgICAgICAgIGVsc2UgcmVzb2x2ZSh7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6IHRydWUgfSkKICAgICAgICB9KQogICAgICB9KQogICAgfQogIH0KfQoKY2xhc3MgV3JpdGFibGUgZXh0ZW5kcyBTdHJlYW0gewogIGNvbnN0cnVjdG9yIChvcHRzKSB7CiAgICBzdXBlcihvcHRzKQoKICAgIHRoaXMuX2R1cGxleFN0YXRlIHw9IE9QRU5JTkcgfCBSRUFEX0RPTkUKICAgIHRoaXMuX3dyaXRhYmxlU3RhdGUgPSBuZXcgV3JpdGFibGVTdGF0ZSh0aGlzLCBvcHRzKQoKICAgIGlmIChvcHRzKSB7CiAgICAgIGlmIChvcHRzLndyaXRldikgdGhpcy5fd3JpdGV2ID0gb3B0cy53cml0ZXYKICAgICAgaWYgKG9wdHMud3JpdGUpIHRoaXMuX3dyaXRlID0gb3B0cy53cml0ZQogICAgICBpZiAob3B0cy5maW5hbCkgdGhpcy5fZmluYWwgPSBvcHRzLmZpbmFsCiAgICAgIGlmIChvcHRzLmVhZ2VyT3BlbikgdGhpcy5fd3JpdGFibGVTdGF0ZS51cGRhdGVOZXh0VGljaygpCiAgICB9CiAgfQoKICBfd3JpdGV2IChiYXRjaCwgY2IpIHsKICAgIGNiKG51bGwpCiAgfQoKICBfd3JpdGUgKGRhdGEsIGNiKSB7CiAgICB0aGlzLl93cml0YWJsZVN0YXRlLmF1dG9CYXRjaChkYXRhLCBjYikKICB9CgogIF9maW5hbCAoY2IpIHsKICAgIGNiKG51bGwpCiAgfQoKICBzdGF0aWMgaXNCYWNrcHJlc3N1cmVkICh3cykgewogICAgcmV0dXJuICh3cy5fZHVwbGV4U3RhdGUgJiBXUklURV9CQUNLUFJFU1NVUkVfU1RBVFVTKSAhPT0gMAogIH0KCiAgc3RhdGljIGRyYWluZWQgKHdzKSB7CiAgICBpZiAod3MuZGVzdHJveWVkKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKQogICAgY29uc3Qgc3RhdGUgPSB3cy5fd3JpdGFibGVTdGF0ZQogICAgY29uc3QgcGVuZGluZyA9IChpc1dyaXRldih3cykgPyBNYXRoLm1pbigxLCBzdGF0ZS5xdWV1ZS5sZW5ndGgpIDogc3RhdGUucXVldWUubGVuZ3RoKQogICAgY29uc3Qgd3JpdGVzID0gcGVuZGluZyArICgod3MuX2R1cGxleFN0YXRlICYgV1JJVEVfV1JJVElORykgPyAxIDogMCkKICAgIGlmICh3cml0ZXMgPT09IDApIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSkKICAgIGlmIChzdGF0ZS5kcmFpbnMgPT09IG51bGwpIHN0YXRlLmRyYWlucyA9IFtdCiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgc3RhdGUuZHJhaW5zLnB1c2goeyB3cml0ZXMsIHJlc29sdmUgfSkKICAgIH0pCiAgfQoKICB3cml0ZSAoZGF0YSkgewogICAgdGhpcy5fd3JpdGFibGVTdGF0ZS51cGRhdGVOZXh0VGljaygpCiAgICByZXR1cm4gdGhpcy5fd3JpdGFibGVTdGF0ZS5wdXNoKGRhdGEpCiAgfQoKICBlbmQgKGRhdGEpIHsKICAgIHRoaXMuX3dyaXRhYmxlU3RhdGUudXBkYXRlTmV4dFRpY2soKQogICAgdGhpcy5fd3JpdGFibGVTdGF0ZS5lbmQoZGF0YSkKICAgIHJldHVybiB0aGlzCiAgfQp9CgpjbGFzcyBEdXBsZXggZXh0ZW5kcyBSZWFkYWJsZSB7IC8vIGFuZCBXcml0YWJsZQogIGNvbnN0cnVjdG9yIChvcHRzKSB7CiAgICBzdXBlcihvcHRzKQoKICAgIHRoaXMuX2R1cGxleFN0YXRlID0gT1BFTklORwogICAgdGhpcy5fd3JpdGFibGVTdGF0ZSA9IG5ldyBXcml0YWJsZVN0YXRlKHRoaXMsIG9wdHMpCgogICAgaWYgKG9wdHMpIHsKICAgICAgaWYgKG9wdHMud3JpdGV2KSB0aGlzLl93cml0ZXYgPSBvcHRzLndyaXRldgogICAgICBpZiAob3B0cy53cml0ZSkgdGhpcy5fd3JpdGUgPSBvcHRzLndyaXRlCiAgICAgIGlmIChvcHRzLmZpbmFsKSB0aGlzLl9maW5hbCA9IG9wdHMuZmluYWwKICAgIH0KICB9CgogIF93cml0ZXYgKGJhdGNoLCBjYikgewogICAgY2IobnVsbCkKICB9CgogIF93cml0ZSAoZGF0YSwgY2IpIHsKICAgIHRoaXMuX3dyaXRhYmxlU3RhdGUuYXV0b0JhdGNoKGRhdGEsIGNiKQogIH0KCiAgX2ZpbmFsIChjYikgewogICAgY2IobnVsbCkKICB9CgogIHdyaXRlIChkYXRhKSB7CiAgICB0aGlzLl93cml0YWJsZVN0YXRlLnVwZGF0ZU5leHRUaWNrKCkKICAgIHJldHVybiB0aGlzLl93cml0YWJsZVN0YXRlLnB1c2goZGF0YSkKICB9CgogIGVuZCAoZGF0YSkgewogICAgdGhpcy5fd3JpdGFibGVTdGF0ZS51cGRhdGVOZXh0VGljaygpCiAgICB0aGlzLl93cml0YWJsZVN0YXRlLmVuZChkYXRhKQogICAgcmV0dXJuIHRoaXMKICB9Cn0KCmNsYXNzIFRyYW5zZm9ybSBleHRlbmRzIER1cGxleCB7CiAgY29uc3RydWN0b3IgKG9wdHMpIHsKICAgIHN1cGVyKG9wdHMpCiAgICB0aGlzLl90cmFuc2Zvcm1TdGF0ZSA9IG5ldyBUcmFuc2Zvcm1TdGF0ZSh0aGlzKQoKICAgIGlmIChvcHRzKSB7CiAgICAgIGlmIChvcHRzLnRyYW5zZm9ybSkgdGhpcy5fdHJhbnNmb3JtID0gb3B0cy50cmFuc2Zvcm0KICAgICAgaWYgKG9wdHMuZmx1c2gpIHRoaXMuX2ZsdXNoID0gb3B0cy5mbHVzaAogICAgfQogIH0KCiAgX3dyaXRlIChkYXRhLCBjYikgewogICAgaWYgKHRoaXMuX3JlYWRhYmxlU3RhdGUuYnVmZmVyZWQgPj0gdGhpcy5fcmVhZGFibGVTdGF0ZS5oaWdoV2F0ZXJNYXJrKSB7CiAgICAgIHRoaXMuX3RyYW5zZm9ybVN0YXRlLmRhdGEgPSBkYXRhCiAgICB9IGVsc2UgewogICAgICB0aGlzLl90cmFuc2Zvcm0oZGF0YSwgdGhpcy5fdHJhbnNmb3JtU3RhdGUuYWZ0ZXJUcmFuc2Zvcm0pCiAgICB9CiAgfQoKICBfcmVhZCAoY2IpIHsKICAgIGlmICh0aGlzLl90cmFuc2Zvcm1TdGF0ZS5kYXRhICE9PSBudWxsKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLl90cmFuc2Zvcm1TdGF0ZS5kYXRhCiAgICAgIHRoaXMuX3RyYW5zZm9ybVN0YXRlLmRhdGEgPSBudWxsCiAgICAgIGNiKG51bGwpCiAgICAgIHRoaXMuX3RyYW5zZm9ybShkYXRhLCB0aGlzLl90cmFuc2Zvcm1TdGF0ZS5hZnRlclRyYW5zZm9ybSkKICAgIH0gZWxzZSB7CiAgICAgIGNiKG51bGwpCiAgICB9CiAgfQoKICBkZXN0cm95IChlcnIpIHsKICAgIHN1cGVyLmRlc3Ryb3koZXJyKQogICAgaWYgKHRoaXMuX3RyYW5zZm9ybVN0YXRlLmRhdGEgIT09IG51bGwpIHsKICAgICAgdGhpcy5fdHJhbnNmb3JtU3RhdGUuZGF0YSA9IG51bGwKICAgICAgdGhpcy5fdHJhbnNmb3JtU3RhdGUuYWZ0ZXJUcmFuc2Zvcm0oKQogICAgfQogIH0KCiAgX3RyYW5zZm9ybSAoZGF0YSwgY2IpIHsKICAgIGNiKG51bGwsIGRhdGEpCiAgfQoKICBfZmx1c2ggKGNiKSB7CiAgICBjYihudWxsKQogIH0KCiAgX2ZpbmFsIChjYikgewogICAgdGhpcy5fdHJhbnNmb3JtU3RhdGUuYWZ0ZXJGaW5hbCA9IGNiCiAgICB0aGlzLl9mbHVzaCh0cmFuc2Zvcm1BZnRlckZsdXNoLmJpbmQodGhpcykpCiAgfQp9CgpjbGFzcyBQYXNzVGhyb3VnaCBleHRlbmRzIFRyYW5zZm9ybSB7fQoKZnVuY3Rpb24gdHJhbnNmb3JtQWZ0ZXJGbHVzaCAoZXJyLCBkYXRhKSB7CiAgY29uc3QgY2IgPSB0aGlzLl90cmFuc2Zvcm1TdGF0ZS5hZnRlckZpbmFsCiAgaWYgKGVycikgcmV0dXJuIGNiKGVycikKICBpZiAoZGF0YSAhPT0gbnVsbCAmJiBkYXRhICE9PSB1bmRlZmluZWQpIHRoaXMucHVzaChkYXRhKQogIHRoaXMucHVzaChudWxsKQogIGNiKG51bGwpCn0KCmZ1bmN0aW9uIHBpcGVsaW5lUHJvbWlzZSAoLi4uc3RyZWFtcykgewogIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICByZXR1cm4gcGlwZWxpbmUoLi4uc3RyZWFtcywgKGVycikgPT4gewogICAgICBpZiAoZXJyKSByZXR1cm4gcmVqZWN0KGVycikKICAgICAgcmVzb2x2ZSgpCiAgICB9KQogIH0pCn0KCmZ1bmN0aW9uIHBpcGVsaW5lIChzdHJlYW0sIC4uLnN0cmVhbXMpIHsKICBjb25zdCBhbGwgPSBBcnJheS5pc0FycmF5KHN0cmVhbSkgPyBbLi4uc3RyZWFtLCAuLi5zdHJlYW1zXSA6IFtzdHJlYW0sIC4uLnN0cmVhbXNdCiAgY29uc3QgZG9uZSA9IChhbGwubGVuZ3RoICYmIHR5cGVvZiBhbGxbYWxsLmxlbmd0aCAtIDFdID09PSAnZnVuY3Rpb24nKSA/IGFsbC5wb3AoKSA6IG51bGwKCiAgaWYgKGFsbC5sZW5ndGggPCAyKSB0aHJvdyBuZXcgRXJyb3IoJ1BpcGVsaW5lIHJlcXVpcmVzIGF0IGxlYXN0IDIgc3RyZWFtcycpCgogIGxldCBzcmMgPSBhbGxbMF0KICBsZXQgZGVzdCA9IG51bGwKICBsZXQgZXJyb3IgPSBudWxsCgogIGZvciAobGV0IGkgPSAxOyBpIDwgYWxsLmxlbmd0aDsgaSsrKSB7CiAgICBkZXN0ID0gYWxsW2ldCgogICAgaWYgKGlzU3RyZWFteChzcmMpKSB7CiAgICAgIHNyYy5waXBlKGRlc3QsIG9uZXJyb3IpCiAgICB9IGVsc2UgewogICAgICBlcnJvckhhbmRsZShzcmMsIHRydWUsIGkgPiAxLCBvbmVycm9yKQogICAgICBzcmMucGlwZShkZXN0KQogICAgfQoKICAgIHNyYyA9IGRlc3QKICB9CgogIGlmIChkb25lKSB7CiAgICBsZXQgZmluID0gZmFsc2UKCiAgICBjb25zdCBhdXRvRGVzdHJveSA9IGlzU3RyZWFteChkZXN0KSB8fCAhIShkZXN0Ll93cml0YWJsZVN0YXRlICYmIGRlc3QuX3dyaXRhYmxlU3RhdGUuYXV0b0Rlc3Ryb3kpCgogICAgZGVzdC5vbignZXJyb3InLCAoZXJyKSA9PiB7CiAgICAgIGlmIChlcnJvciA9PT0gbnVsbCkgZXJyb3IgPSBlcnIKICAgIH0pCgogICAgZGVzdC5vbignZmluaXNoJywgKCkgPT4gewogICAgICBmaW4gPSB0cnVlCiAgICAgIGlmICghYXV0b0Rlc3Ryb3kpIGRvbmUoZXJyb3IpCiAgICB9KQoKICAgIGlmIChhdXRvRGVzdHJveSkgewogICAgICBkZXN0Lm9uKCdjbG9zZScsICgpID0+IGRvbmUoZXJyb3IgfHwgKGZpbiA/IG51bGwgOiBQUkVNQVRVUkVfQ0xPU0UpKSkKICAgIH0KICB9CgogIHJldHVybiBkZXN0CgogIGZ1bmN0aW9uIGVycm9ySGFuZGxlIChzLCByZCwgd3IsIG9uZXJyb3IpIHsKICAgIHMub24oJ2Vycm9yJywgb25lcnJvcikKICAgIHMub24oJ2Nsb3NlJywgb25jbG9zZSkKCiAgICBmdW5jdGlvbiBvbmNsb3NlICgpIHsKICAgICAgaWYgKHJkICYmIHMuX3JlYWRhYmxlU3RhdGUgJiYgIXMuX3JlYWRhYmxlU3RhdGUuZW5kZWQpIHJldHVybiBvbmVycm9yKFBSRU1BVFVSRV9DTE9TRSkKICAgICAgaWYgKHdyICYmIHMuX3dyaXRhYmxlU3RhdGUgJiYgIXMuX3dyaXRhYmxlU3RhdGUuZW5kZWQpIHJldHVybiBvbmVycm9yKFBSRU1BVFVSRV9DTE9TRSkKICAgIH0KICB9CgogIGZ1bmN0aW9uIG9uZXJyb3IgKGVycikgewogICAgaWYgKCFlcnIgfHwgZXJyb3IpIHJldHVybgogICAgZXJyb3IgPSBlcnIKCiAgICBmb3IgKGNvbnN0IHMgb2YgYWxsKSB7CiAgICAgIHMuZGVzdHJveShlcnIpCiAgICB9CiAgfQp9CgpmdW5jdGlvbiBpc1N0cmVhbSAoc3RyZWFtKSB7CiAgcmV0dXJuICEhc3RyZWFtLl9yZWFkYWJsZVN0YXRlIHx8ICEhc3RyZWFtLl93cml0YWJsZVN0YXRlCn0KCmZ1bmN0aW9uIGlzU3RyZWFteCAoc3RyZWFtKSB7CiAgcmV0dXJuIHR5cGVvZiBzdHJlYW0uX2R1cGxleFN0YXRlID09PSAnbnVtYmVyJyAmJiBpc1N0cmVhbShzdHJlYW0pCn0KCmZ1bmN0aW9uIGdldFN0cmVhbUVycm9yIChzdHJlYW0pIHsKICBjb25zdCBlcnIgPSAoc3RyZWFtLl9yZWFkYWJsZVN0YXRlICYmIHN0cmVhbS5fcmVhZGFibGVTdGF0ZS5lcnJvcikgfHwgKHN0cmVhbS5fd3JpdGFibGVTdGF0ZSAmJiBzdHJlYW0uX3dyaXRhYmxlU3RhdGUuZXJyb3IpCiAgcmV0dXJuIGVyciA9PT0gU1RSRUFNX0RFU1RST1lFRCA/IG51bGwgOiBlcnIgLy8gb25seSBleHBsaWNpdCBlcnJvcnMKfQoKZnVuY3Rpb24gaXNSZWFkU3RyZWFteCAoc3RyZWFtKSB7CiAgcmV0dXJuIGlzU3RyZWFteChzdHJlYW0pICYmIHN0cmVhbS5yZWFkYWJsZQp9CgpmdW5jdGlvbiBpc1R5cGVkQXJyYXkgKGRhdGEpIHsKICByZXR1cm4gdHlwZW9mIGRhdGEgPT09ICdvYmplY3QnICYmIGRhdGEgIT09IG51bGwgJiYgdHlwZW9mIGRhdGEuYnl0ZUxlbmd0aCA9PT0gJ251bWJlcicKfQoKZnVuY3Rpb24gZGVmYXVsdEJ5dGVMZW5ndGggKGRhdGEpIHsKICByZXR1cm4gaXNUeXBlZEFycmF5KGRhdGEpID8gZGF0YS5ieXRlTGVuZ3RoIDogMTAyNAp9CgpmdW5jdGlvbiBub29wICgpIHt9CgpmdW5jdGlvbiBhYm9ydCAoKSB7CiAgdGhpcy5kZXN0cm95KG5ldyBFcnJvcignU3RyZWFtIGFib3J0ZWQuJykpCn0KCmZ1bmN0aW9uIGlzV3JpdGV2IChzKSB7CiAgcmV0dXJuIHMuX3dyaXRldiAhPT0gV3JpdGFibGUucHJvdG90eXBlLl93cml0ZXYgJiYgcy5fd3JpdGV2ICE9PSBEdXBsZXgucHJvdG90eXBlLl93cml0ZXYKfQoKbW9kdWxlLmV4cG9ydHMgPSB7CiAgcGlwZWxpbmUsCiAgcGlwZWxpbmVQcm9taXNlLAogIGlzU3RyZWFtLAogIGlzU3RyZWFteCwKICBnZXRTdHJlYW1FcnJvciwKICBTdHJlYW0sCiAgV3JpdGFibGUsCiAgUmVhZGFibGUsCiAgRHVwbGV4LAogIFRyYW5zZm9ybSwKICAvLyBFeHBvcnQgUGFzc1Rocm91Z2ggZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBOb2RlLmpzIGNvcmUncyBzdHJlYW0gbW9kdWxlCiAgUGFzc1Rocm91Z2gKfQpjb25zdCBlcnJvcnMgPSByZXF1aXJlKCcuL2xpYi9lcnJvcnMnKQoKY2xhc3MgRXZlbnRMaXN0ZW5lciB7CiAgY29uc3RydWN0b3IgKCkgewogICAgdGhpcy5saXN0ID0gW10KICB9CgogIGFwcGVuZCAoY3R4LCBuYW1lLCBmbiwgb25jZSkgewogICAgY3R4LmVtaXQoJ25ld0xpc3RlbmVyJywgbmFtZSwgZm4pIC8vIEVtaXQgQkVGT1JFIGFkZGluZwogICAgdGhpcy5saXN0LnB1c2goW2ZuLCBvbmNlXSkKICB9CgogIHByZXBlbmQgKGN0eCwgbmFtZSwgZm4sIG9uY2UpIHsKICAgIGN0eC5lbWl0KCduZXdMaXN0ZW5lcicsIG5hbWUsIGZuKSAvLyBFbWl0IEJFRk9SRSBhZGRpbmcKICAgIHRoaXMubGlzdC51bnNoaWZ0KFtmbiwgb25jZV0pCiAgfQoKICByZW1vdmUgKGN0eCwgbmFtZSwgZm4pIHsKICAgIGZvciAobGV0IGkgPSAwLCBuID0gdGhpcy5saXN0Lmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICBjb25zdCBsID0gdGhpcy5saXN0W2ldCgogICAgICBpZiAobFswXSA9PT0gZm4pIHsKICAgICAgICB0aGlzLmxpc3Quc3BsaWNlKGksIDEpCgogICAgICAgIGlmICh0aGlzLmxpc3QubGVuZ3RoID09PSAwKSBkZWxldGUgY3R4Ll9ldmVudHNbbmFtZV0KCiAgICAgICAgY3R4LmVtaXQoJ3JlbW92ZUxpc3RlbmVyJywgbmFtZSwgZm4pIC8vIEVtaXQgQUZURVIgcmVtb3ZpbmcKICAgICAgICByZXR1cm4KICAgICAgfQogICAgfQogIH0KCiAgcmVtb3ZlQWxsIChjdHgsIG5hbWUpIHsKICAgIGNvbnN0IGxpc3QgPSBbLi4udGhpcy5saXN0XQogICAgdGhpcy5saXN0ID0gW10KCiAgICBmb3IgKGxldCBpID0gbGlzdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICBjdHguZW1pdCgncmVtb3ZlTGlzdGVuZXInLCBuYW1lLCBsaXN0W2ldWzBdKSAvLyBFbWl0IEFGVEVSIHJlbW92aW5nCiAgICB9CgogICAgaWYgKHRoaXMubGlzdC5sZW5ndGggPT09IDApIGRlbGV0ZSBjdHguX2V2ZW50c1tuYW1lXQogIH0KCiAgZW1pdCAoY3R4LCBuYW1lLCAuLi5hcmdzKSB7CiAgICBjb25zdCBsaXN0ID0gWy4uLnRoaXMubGlzdF0KCiAgICBmb3IgKGxldCBpID0gMCwgbiA9IGxpc3QubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgIGNvbnN0IGwgPSBsaXN0W2ldCgogICAgICBpZiAobFsxXSA9PT0gdHJ1ZSkgdGhpcy5yZW1vdmUoY3R4LCBuYW1lLCBsWzBdKQoKICAgICAgbFswXS5jYWxsKGN0eCwgLi4uYXJncykKICAgIH0KCiAgICByZXR1cm4gbGlzdC5sZW5ndGggPiAwCiAgfQp9CgpmdW5jdGlvbiBhcHBlbmRMaXN0ZW5lciAoY3R4LCBuYW1lLCBmbiwgb25jZSkgewogIGNvbnN0IGUgPSBjdHguX2V2ZW50c1tuYW1lXSB8fCAoY3R4Ll9ldmVudHNbbmFtZV0gPSBuZXcgRXZlbnRMaXN0ZW5lcigpKQogIGUuYXBwZW5kKGN0eCwgbmFtZSwgZm4sIG9uY2UpCiAgcmV0dXJuIGN0eAp9CgpmdW5jdGlvbiBwcmVwZW5kTGlzdGVuZXIgKGN0eCwgbmFtZSwgZm4sIG9uY2UpIHsKICBjb25zdCBlID0gY3R4Ll9ldmVudHNbbmFtZV0gfHwgKGN0eC5fZXZlbnRzW25hbWVdID0gbmV3IEV2ZW50TGlzdGVuZXIoKSkKICBlLnByZXBlbmQoY3R4LCBuYW1lLCBmbiwgb25jZSkKICByZXR1cm4gY3R4Cn0KCmZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyIChjdHgsIG5hbWUsIGZuKSB7CiAgY29uc3QgZSA9IGN0eC5fZXZlbnRzW25hbWVdCiAgaWYgKGUgIT09IHVuZGVmaW5lZCkgZS5yZW1vdmUoY3R4LCBuYW1lLCBmbikKICByZXR1cm4gY3R4Cn0KCm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cyA9IGNsYXNzIEV2ZW50RW1pdHRlciB7CiAgY29uc3RydWN0b3IgKCkgewogICAgdGhpcy5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKQogIH0KCiAgYWRkTGlzdGVuZXIgKG5hbWUsIGZuKSB7CiAgICByZXR1cm4gYXBwZW5kTGlzdGVuZXIodGhpcywgbmFtZSwgZm4sIGZhbHNlKQogIH0KCiAgYWRkT25jZUxpc3RlbmVyIChuYW1lLCBmbikgewogICAgcmV0dXJuIGFwcGVuZExpc3RlbmVyKHRoaXMsIG5hbWUsIGZuLCB0cnVlKQogIH0KCiAgcHJlcGVuZExpc3RlbmVyIChuYW1lLCBmbikgewogICAgcmV0dXJuIHByZXBlbmRMaXN0ZW5lcih0aGlzLCBuYW1lLCBmbiwgZmFsc2UpCiAgfQoKICBwcmVwZW5kT25jZUxpc3RlbmVyIChuYW1lLCBmbikgewogICAgcmV0dXJuIHByZXBlbmRMaXN0ZW5lcih0aGlzLCBuYW1lLCBmbiwgdHJ1ZSkKICB9CgogIHJlbW92ZUxpc3RlbmVyIChuYW1lLCBmbikgewogICAgcmV0dXJuIHJlbW92ZUxpc3RlbmVyKHRoaXMsIG5hbWUsIGZuKQogIH0KCiAgb24gKG5hbWUsIGZuKSB7CiAgICByZXR1cm4gYXBwZW5kTGlzdGVuZXIodGhpcywgbmFtZSwgZm4sIGZhbHNlKQogIH0KCiAgb25jZSAobmFtZSwgZm4pIHsKICAgIHJldHVybiBhcHBlbmRMaXN0ZW5lcih0aGlzLCBuYW1lLCBmbiwgdHJ1ZSkKICB9CgogIG9mZiAobmFtZSwgZm4pIHsKICAgIHJldHVybiByZW1vdmVMaXN0ZW5lcih0aGlzLCBuYW1lLCBmbikKICB9CgogIGVtaXQgKG5hbWUsIC4uLmFyZ3MpIHsKICAgIGNvbnN0IGUgPSB0aGlzLl9ldmVudHNbbmFtZV0KICAgIHJldHVybiBlID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGUuZW1pdCh0aGlzLCBuYW1lLCAuLi5hcmdzKQogIH0KCiAgbGlzdGVuZXJzIChuYW1lKSB7CiAgICBjb25zdCBlID0gdGhpcy5fZXZlbnRzW25hbWVdCiAgICByZXR1cm4gZSA9PT0gdW5kZWZpbmVkID8gW10gOiBbLi4uZS5saXN0XQogIH0KCiAgbGlzdGVuZXJDb3VudCAobmFtZSkgewogICAgY29uc3QgZSA9IHRoaXMuX2V2ZW50c1tuYW1lXQogICAgcmV0dXJuIGUgPT09IHVuZGVmaW5lZCA/IDAgOiBlLmxpc3QubGVuZ3RoCiAgfQoKICBnZXRNYXhMaXN0ZW5lcnMgKCkgewogICAgcmV0dXJuIEV2ZW50RW1pdHRlci5kZWZhdWx0TWF4TGlzdGVuZXJzCiAgfQoKICBzZXRNYXhMaXN0ZW5lcnMgKG4pIHt9CgogIHJlbW92ZUFsbExpc3RlbmVycyAobmFtZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgZm9yIChjb25zdCBrZXkgb2YgUmVmbGVjdC5vd25LZXlzKHRoaXMuX2V2ZW50cykpIHsKICAgICAgICBpZiAoa2V5ID09PSAncmVtb3ZlTGlzdGVuZXInKSBjb250aW51ZQogICAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKGtleSkKICAgICAgfQogICAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygncmVtb3ZlTGlzdGVuZXInKQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZSA9IHRoaXMuX2V2ZW50c1tuYW1lXQogICAgICBpZiAoZSAhPT0gdW5kZWZpbmVkKSBlLnJlbW92ZUFsbCh0aGlzLCBuYW1lKQogICAgfQogICAgcmV0dXJuIHRoaXMKICB9Cn0KCmV4cG9ydHMuRXZlbnRFbWl0dGVyID0gZXhwb3J0cwoKZXhwb3J0cy5kZWZhdWx0TWF4TGlzdGVuZXJzID0gMTAKCmV4cG9ydHMub24gPSBmdW5jdGlvbiBvbiAoZW1pdHRlciwgbmFtZSwgb3B0cyA9IHt9KSB7CiAgY29uc3QgewogICAgc2lnbmFsCiAgfSA9IG9wdHMKCiAgaWYgKHNpZ25hbCAmJiBzaWduYWwuYWJvcnRlZCkgewogICAgdGhyb3cgZXJyb3JzLk9QRVJBVElPTl9BQk9SVEVEKHNpZ25hbC5yZWFzb24pCiAgfQoKICBsZXQgZXJyb3IgPSBudWxsCiAgbGV0IGRvbmUgPSBmYWxzZQoKICBjb25zdCBldmVudHMgPSBbXQogIGNvbnN0IHByb21pc2VzID0gW10KCiAgZW1pdHRlci5vbihuYW1lLCBvbmV2ZW50KQoKICBpZiAobmFtZSAhPT0gJ2Vycm9yJykgZW1pdHRlci5vbignZXJyb3InLCBvbmVycm9yKQoKICBpZiAoc2lnbmFsKSBzaWduYWwuYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBvbmFib3J0KQoKICByZXR1cm4gewogICAgbmV4dCAoKSB7CiAgICAgIGlmIChldmVudHMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7IHZhbHVlOiBldmVudHMuc2hpZnQoKSwgZG9uZTogZmFsc2UgfSkKICAgICAgfQoKICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgY29uc3QgZXJyID0gZXJyb3IKCiAgICAgICAgZXJyb3IgPSBudWxsCgogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpCiAgICAgIH0KCiAgICAgIGlmIChkb25lKSByZXR1cm4gb25jbG9zZSgpCgogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4KICAgICAgICBwcm9taXNlcy5wdXNoKHsgcmVzb2x2ZSwgcmVqZWN0IH0pCiAgICAgICkKICAgIH0sCgogICAgcmV0dXJuICgpIHsKICAgICAgcmV0dXJuIG9uY2xvc2UoKQogICAgfSwKCiAgICB0aHJvdyAoZXJyKSB7CiAgICAgIHJldHVybiBvbmVycm9yKGVycikKICAgIH0sCgogICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSAoKSB7CiAgICAgIHJldHVybiB0aGlzCiAgICB9CiAgfQoKICBmdW5jdGlvbiBvbmV2ZW50ICguLi5hcmdzKSB7CiAgICBpZiAocHJvbWlzZXMubGVuZ3RoKSB7CiAgICAgIHByb21pc2VzLnNoaWZ0KCkucmVzb2x2ZSh7IHZhbHVlOiBhcmdzLCBkb25lOiBmYWxzZSB9KQogICAgfSBlbHNlIHsKICAgICAgZXZlbnRzLnB1c2goYXJncykKICAgIH0KICB9CgogIGZ1bmN0aW9uIG9uZXJyb3IgKGVycikgewogICAgaWYgKHByb21pc2VzLmxlbmd0aCkgewogICAgICBwcm9taXNlcy5zaGlmdCgpLnJlamVjdChlcnIpCiAgICB9IGVsc2UgewogICAgICBlcnJvciA9IGVycgogICAgfQoKICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyBkb25lOiB0cnVlIH0pCiAgfQoKICBmdW5jdGlvbiBvbmFib3J0ICgpIHsKICAgIG9uZXJyb3IoZXJyb3JzLk9QRVJBVElPTl9BQk9SVEVEKHNpZ25hbC5yZWFzb24pKQogIH0KCiAgZnVuY3Rpb24gb25jbG9zZSAoKSB7CiAgICBlbWl0dGVyLm9mZihuYW1lLCBvbmV2ZW50KQoKICAgIGlmIChuYW1lICE9PSAnZXJyb3InKSBlbWl0dGVyLm9mZignZXJyb3InLCBvbmVycm9yKQoKICAgIGlmIChzaWduYWwpIHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCdhYm9ydCcsIG9uYWJvcnQpCgogICAgZG9uZSA9IHRydWUKCiAgICBpZiAocHJvbWlzZXMubGVuZ3RoKSBwcm9taXNlcy5zaGlmdCgpLnJlc29sdmUoeyBkb25lOiB0cnVlIH0pCgogICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7IGRvbmU6IHRydWUgfSkKICB9Cn0KCmV4cG9ydHMub25jZSA9IGZ1bmN0aW9uIG9uY2UgKGVtaXR0ZXIsIG5hbWUsIG9wdHMgPSB7fSkgewogIGNvbnN0IHsKICAgIHNpZ25hbAogIH0gPSBvcHRzCgogIGlmIChzaWduYWwgJiYgc2lnbmFsLmFib3J0ZWQpIHsKICAgIHRocm93IGVycm9ycy5PUEVSQVRJT05fQUJPUlRFRChzaWduYWwucmVhc29uKQogIH0KCiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgIGlmIChzaWduYWwpIHNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIG9uYWJvcnQpCgogICAgZW1pdHRlci5vbmNlKG5hbWUsICguLi5hcmdzKSA9PiB7CiAgICAgIGlmIChzaWduYWwpIHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCdhYm9ydCcsIG9uYWJvcnQpCgogICAgICByZXNvbHZlKGFyZ3MpCiAgICB9KQoKICAgIGZ1bmN0aW9uIG9uYWJvcnQgKCkgewogICAgICByZWplY3QoZXJyb3JzLk9QRVJBVElPTl9BQk9SVEVEKHNpZ25hbC5yZWFzb24pKQogICAgfQogIH0pCn0KbW9kdWxlLmV4cG9ydHMgPSAodHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBwcm9jZXNzLm5leHRUaWNrID09PSAnZnVuY3Rpb24nKQogID8gcHJvY2Vzcy5uZXh0VGljay5iaW5kKHByb2Nlc3MpCiAgOiByZXF1aXJlKCcuL3F1ZXVlLW1pY3JvdGFzaycpCmNvbnN0IEZpeGVkRklGTyA9IHJlcXVpcmUoJy4vZml4ZWQtc2l6ZScpCgptb2R1bGUuZXhwb3J0cyA9IGNsYXNzIEZhc3RGSUZPIHsKICBjb25zdHJ1Y3RvciAoaHdtKSB7CiAgICB0aGlzLmh3bSA9IGh3bSB8fCAxNgogICAgdGhpcy5oZWFkID0gbmV3IEZpeGVkRklGTyh0aGlzLmh3bSkKICAgIHRoaXMudGFpbCA9IHRoaXMuaGVhZAogICAgdGhpcy5sZW5ndGggPSAwCiAgfQoKICBjbGVhciAoKSB7CiAgICB0aGlzLmhlYWQgPSB0aGlzLnRhaWwKICAgIHRoaXMuaGVhZC5jbGVhcigpCiAgICB0aGlzLmxlbmd0aCA9IDAKICB9CgogIHB1c2ggKHZhbCkgewogICAgdGhpcy5sZW5ndGgrKwogICAgaWYgKCF0aGlzLmhlYWQucHVzaCh2YWwpKSB7CiAgICAgIGNvbnN0IHByZXYgPSB0aGlzLmhlYWQKICAgICAgdGhpcy5oZWFkID0gcHJldi5uZXh0ID0gbmV3IEZpeGVkRklGTygyICogdGhpcy5oZWFkLmJ1ZmZlci5sZW5ndGgpCiAgICAgIHRoaXMuaGVhZC5wdXNoKHZhbCkKICAgIH0KICB9CgogIHNoaWZ0ICgpIHsKICAgIGlmICh0aGlzLmxlbmd0aCAhPT0gMCkgdGhpcy5sZW5ndGgtLQogICAgY29uc3QgdmFsID0gdGhpcy50YWlsLnNoaWZ0KCkKICAgIGlmICh2YWwgPT09IHVuZGVmaW5lZCAmJiB0aGlzLnRhaWwubmV4dCkgewogICAgICBjb25zdCBuZXh0ID0gdGhpcy50YWlsLm5leHQKICAgICAgdGhpcy50YWlsLm5leHQgPSBudWxsCiAgICAgIHRoaXMudGFpbCA9IG5leHQKICAgICAgcmV0dXJuIHRoaXMudGFpbC5zaGlmdCgpCiAgICB9CgogICAgcmV0dXJuIHZhbAogIH0KCiAgcGVlayAoKSB7CiAgICBjb25zdCB2YWwgPSB0aGlzLnRhaWwucGVlaygpCiAgICBpZiAodmFsID09PSB1bmRlZmluZWQgJiYgdGhpcy50YWlsLm5leHQpIHJldHVybiB0aGlzLnRhaWwubmV4dC5wZWVrKCkKICAgIHJldHVybiB2YWwKICB9CgogIGlzRW1wdHkgKCkgewogICAgcmV0dXJuIHRoaXMubGVuZ3RoID09PSAwCiAgfQp9CnsKICAibmFtZSI6ICJzdHJlYW14IiwKICAidmVyc2lvbiI6ICIyLjE1LjciLAogICJkZXNjcmlwdGlvbiI6ICJBbiBpdGVyYXRpb24gb2YgdGhlIE5vZGUuanMgY29yZSBzdHJlYW1zIHdpdGggYSBzZXJpZXMgb2YgaW1wcm92ZW1lbnRzIiwKICAibWFpbiI6ICJpbmRleC5qcyIsCiAgImRlcGVuZGVuY2llcyI6IHsKICAgICJmYXN0LWZpZm8iOiAiXjEuMS4wIiwKICAgICJxdWV1ZS10aWNrIjogIl4xLjAuMSIKICB9LAogICJkZXZEZXBlbmRlbmNpZXMiOiB7CiAgICAiYnJpdHRsZSI6ICJeMy4xLjEiLAogICAgImVuZC1vZi1zdHJlYW0iOiAiXjEuNC40IiwKICAgICJzdGFuZGFyZCI6ICJeMTcuMC4wIgogIH0sCiAgImZpbGVzIjogWwogICAgImluZGV4LmpzIgogIF0sCiAgImltcG9ydHMiOiB7CiAgICAiZXZlbnRzIjogewogICAgICAiYmFyZSI6ICJiYXJlLWV2ZW50cyIsCiAgICAgICJkZWZhdWx0IjogImV2ZW50cyIKICAgIH0KICB9LAogICJzY3JpcHRzIjogewogICAgInRlc3QiOiAic3RhbmRhcmQgJiYgYnJpdHRsZSB0ZXN0LyouanMiCiAgfSwKICAicmVwb3NpdG9yeSI6IHsKICAgICJ0eXBlIjogImdpdCIsCiAgICAidXJsIjogImh0dHBzOi8vZ2l0aHViLmNvbS9tYWZpbnRvc2gvc3RyZWFteC5naXQiCiAgfSwKICAiYXV0aG9yIjogIk1hdGhpYXMgQnV1cyAoQG1hZmludG9zaCkiLAogICJsaWNlbnNlIjogIk1JVCIsCiAgImJ1Z3MiOiB7CiAgICAidXJsIjogImh0dHBzOi8vZ2l0aHViLmNvbS9tYWZpbnRvc2gvc3RyZWFteC9pc3N1ZXMiCiAgfSwKICAiaG9tZXBhZ2UiOiAiaHR0cHM6Ly9naXRodWIuY29tL21hZmludG9zaC9zdHJlYW14Igp9Cm1vZHVsZS5leHBvcnRzID0gY2xhc3MgRXZlbnRFbWl0dGVyRXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgY29uc3RydWN0b3IgKG1zZywgY29kZSwgZm4gPSBFdmVudEVtaXR0ZXJFcnJvciwgb3B0cykgewogICAgc3VwZXIoYCR7Y29kZX06ICR7bXNnfWAsIG9wdHMpCiAgICB0aGlzLmNvZGUgPSBjb2RlCgogICAgaWYgKEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKSB7CiAgICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIGZuKQogICAgfQogIH0KCiAgZ2V0IG5hbWUgKCkgewogICAgcmV0dXJuICdFdmVudEVtaXR0ZXJFcnJvcicKICB9CgogIHN0YXRpYyBPUEVSQVRJT05fQUJPUlRFRCAoY2F1c2UsIG1zZyA9ICdPcGVyYXRpb24gYWJvcnRlZCcpIHsKICAgIHJldHVybiBuZXcgRXZlbnRFbWl0dGVyRXJyb3IobXNnLCAnT1BFUkFUSU9OX0FCT1JURUQnLCBFdmVudEVtaXR0ZXJFcnJvci5PUEVSQVRJT05fQUJPUlRFRCwgeyBjYXVzZSB9KQogIH0KfQp7CiAgIm5hbWUiOiAiYmFyZS1ldmVudHMiLAogICJ2ZXJzaW9uIjogIjIuMi4wIiwKICAiZGVzY3JpcHRpb24iOiAiRXZlbnQgZW1pdHRlcnMgZm9yIEphdmFTY3JpcHQiLAogICJtYWluIjogImluZGV4LmpzIiwKICAiZmlsZXMiOiBbCiAgICAiaW5kZXguanMiLAogICAgImxpYiIKICBdLAogICJzY3JpcHRzIjogewogICAgInRlc3QiOiAic3RhbmRhcmQgJiYgYmFyZSB0ZXN0LmpzIgogIH0sCiAgInJlcG9zaXRvcnkiOiB7CiAgICAidHlwZSI6ICJnaXQiLAogICAgInVybCI6ICJnaXQraHR0cHM6Ly9naXRodWIuY29tL2hvbGVwdW5jaHRvL2JhcmUtZXZlbnRzLmdpdCIKICB9LAogICJhdXRob3IiOiAiSG9sZXB1bmNoIiwKICAibGljZW5zZSI6ICJBcGFjaGUtMi4wIiwKICAiYnVncyI6IHsKICAgICJ1cmwiOiAiaHR0cHM6Ly9naXRodWIuY29tL2hvbGVwdW5jaHRvL2JhcmUtZXZlbnRzL2lzc3VlcyIKICB9LAogICJob21lcGFnZSI6ICJodHRwczovL2dpdGh1Yi5jb20vaG9sZXB1bmNodG8vYmFyZS1ldmVudHMjcmVhZG1lIiwKICAiZGV2RGVwZW5kZW5jaWVzIjogewogICAgImJyaXR0bGUiOiAiXjMuMy4yIiwKICAgICJzdGFuZGFyZCI6ICJeMTcuMC4wIgogIH0KfQptb2R1bGUuZXhwb3J0cyA9IHR5cGVvZiBxdWV1ZU1pY3JvdGFzayA9PT0gJ2Z1bmN0aW9uJyA/IHF1ZXVlTWljcm90YXNrIDogKGZuKSA9PiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZuKQp7CiAgIm5hbWUiOiAicXVldWUtdGljayIsCiAgInZlcnNpb24iOiAiMS4wLjEiLAogICJkZXNjcmlwdGlvbiI6ICJOZXh0IHRpY2sgc2hpbSB0aGF0IHByZWZlcnMgcHJvY2Vzcy5uZXh0VGljayBvdmVyIHF1ZXVlTWljcm90YXNrIGZvciBjb21wYXQiLAogICJtYWluIjogIi4vcHJvY2Vzcy1uZXh0LXRpY2suanMiLAogICJicm93c2VyIjogIi4vcXVldWUtbWljcm90YXNrLmpzIiwKICAiZGVwZW5kZW5jaWVzIjoge30sCiAgImRldkRlcGVuZGVuY2llcyI6IHsKICAgICJzdGFuZGFyZCI6ICJeMTYuMC4zIiwKICAgICJ0YXBlIjogIl41LjMuMSIKICB9LAogICJzY3JpcHRzIjogewogICAgInRlc3QiOiAic3RhbmRhcmQgJiYgdGFwZSB0ZXN0LmpzIgogIH0sCiAgInJlcG9zaXRvcnkiOiB7CiAgICAidHlwZSI6ICJnaXQiLAogICAgInVybCI6ICJodHRwczovL2dpdGh1Yi5jb20vbWFmaW50b3NoL3F1ZXVlLXRpY2suZ2l0IgogIH0sCiAgImF1dGhvciI6ICJNYXRoaWFzIEJ1dXMgKEBtYWZpbnRvc2gpIiwKICAibGljZW5zZSI6ICJNSVQiLAogICJidWdzIjogewogICAgInVybCI6ICJodHRwczovL2dpdGh1Yi5jb20vbWFmaW50b3NoL3F1ZXVlLXRpY2svaXNzdWVzIgogIH0sCiAgImhvbWVwYWdlIjogImh0dHBzOi8vZ2l0aHViLmNvbS9tYWZpbnRvc2gvcXVldWUtdGljayIKfQptb2R1bGUuZXhwb3J0cyA9IGNsYXNzIEZpeGVkRklGTyB7CiAgY29uc3RydWN0b3IgKGh3bSkgewogICAgaWYgKCEoaHdtID4gMCkgfHwgKChod20gLSAxKSAmIGh3bSkgIT09IDApIHRocm93IG5ldyBFcnJvcignTWF4IHNpemUgZm9yIGEgRml4ZWRGSUZPIHNob3VsZCBiZSBhIHBvd2VyIG9mIHR3bycpCiAgICB0aGlzLmJ1ZmZlciA9IG5ldyBBcnJheShod20pCiAgICB0aGlzLm1hc2sgPSBod20gLSAxCiAgICB0aGlzLnRvcCA9IDAKICAgIHRoaXMuYnRtID0gMAogICAgdGhpcy5uZXh0ID0gbnVsbAogIH0KCiAgY2xlYXIgKCkgewogICAgdGhpcy50b3AgPSB0aGlzLmJ0bSA9IDAKICAgIHRoaXMubmV4dCA9IG51bGwKICAgIHRoaXMuYnVmZmVyLmZpbGwodW5kZWZpbmVkKQogIH0KCiAgcHVzaCAoZGF0YSkgewogICAgaWYgKHRoaXMuYnVmZmVyW3RoaXMudG9wXSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gZmFsc2UKICAgIHRoaXMuYnVmZmVyW3RoaXMudG9wXSA9IGRhdGEKICAgIHRoaXMudG9wID0gKHRoaXMudG9wICsgMSkgJiB0aGlzLm1hc2sKICAgIHJldHVybiB0cnVlCiAgfQoKICBzaGlmdCAoKSB7CiAgICBjb25zdCBsYXN0ID0gdGhpcy5idWZmZXJbdGhpcy5idG1dCiAgICBpZiAobGFzdCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdW5kZWZpbmVkCiAgICB0aGlzLmJ1ZmZlclt0aGlzLmJ0bV0gPSB1bmRlZmluZWQKICAgIHRoaXMuYnRtID0gKHRoaXMuYnRtICsgMSkgJiB0aGlzLm1hc2sKICAgIHJldHVybiBsYXN0CiAgfQoKICBwZWVrICgpIHsKICAgIHJldHVybiB0aGlzLmJ1ZmZlclt0aGlzLmJ0bV0KICB9CgogIGlzRW1wdHkgKCkgewogICAgcmV0dXJuIHRoaXMuYnVmZmVyW3RoaXMuYnRtXSA9PT0gdW5kZWZpbmVkCiAgfQp9CnsKICAibmFtZSI6ICJmYXN0LWZpZm8iLAogICJ2ZXJzaW9uIjogIjEuMy4yIiwKICAiZGVzY3JpcHRpb24iOiAiQSBmYXN0IGZpZm8gaW1wbGVtZW50YXRpb24gc2ltaWxhciB0byB0aGUgb25lIHBvd2VyaW5nIG5leHRUaWNrIGluIE5vZGUuanMgY29yZSIsCiAgIm1haW4iOiAiaW5kZXguanMiLAogICJmaWxlcyI6IFsKICAgICIuL2luZGV4LmpzIiwKICAgICIuL2ZpeGVkLXNpemUuanMiCiAgXSwKICAiZGVwZW5kZW5jaWVzIjoge30sCiAgImRldkRlcGVuZGVuY2llcyI6IHsKICAgICJzdGFuZGFyZCI6ICJeMTcuMS4wIiwKICAgICJicml0dGxlIjogIl4zLjMuMiIKICB9LAogICJzY3JpcHRzIjogewogICAgInRlc3QiOiAic3RhbmRhcmQgJiYgYnJpdHRsZSB0ZXN0LmpzIgogIH0sCiAgInJlcG9zaXRvcnkiOiB7CiAgICAidHlwZSI6ICJnaXQiLAogICAgInVybCI6ICJodHRwczovL2dpdGh1Yi5jb20vbWFmaW50b3NoL2Zhc3QtZmlmby5naXQiCiAgfSwKICAiYXV0aG9yIjogIk1hdGhpYXMgQnV1cyAoQG1hZmludG9zaCkiLAogICJsaWNlbnNlIjogIk1JVCIsCiAgImJ1Z3MiOiB7CiAgICAidXJsIjogImh0dHBzOi8vZ2l0aHViLmNvbS9tYWZpbnRvc2gvZmFzdC1maWZvL2lzc3VlcyIKICB9LAogICJob21lcGFnZSI6ICJodHRwczovL2dpdGh1Yi5jb20vbWFmaW50b3NoL2Zhc3QtZmlmbyIKfQo=', 'base64')
